[ { "title": "ESXi 8 consumer NVMe SSD not recognized", "url": "/posts/esxi-8-consumer-nvme-ssd-not-recognized/", "categories": "Documentation, Tutorials", "tags": "documentation, homelab, storage, nvme, esxi, vsphere8, troubleshooting, tutorial", "date": "2023-08-16 13:05:10 +0200", "snippet": "This is an update for ESXi 8 in the “consumer NVMe SSD not being recognized since ESXi 6.7U1” series. Just like previous versions, several consumer NVMe controllers are having problems being recognized in ESXi 8. Although the VMware community fling has been deprecated due to default addition of some NVMe controllers from the fling to the ESXi 8 image, one controller brand is still left out. Specifically, Silicon Motion controllers, used by ADATA in almost all their NVMe drives and I’m sure they are in others.VMware Flings driverAs mentioned above, the community driver has officially been deprecated due to default driver additions to ESXi 8. However, this community driver still contains the Silicon Motion and ADATA drives to add support. Unfortunately this community driver was released only for ESXI 6.7 and 7, ESXi 8 is not supported.Luckily, last weekend I was able to test ESXi 8 Update 1 on my server with ADATA NVMe drives and figured, why not just install the deprecated fling and see if it works! …. It worked!Before you jump right in though, there are a few caveats you have to keep in mind. It will not work for every NVMe drive! You can find the community driver at the VMware Flings website ⧉.Your path to a working NVMe driveLike I said above, there are some caveats, unfortunately the community drivers don’t support all known NVMe drives out there. In fact, at the time of writing this, only the following NVMe drives are supported by the community driver: Vendor VendorID ProductID ADATA 0x1cc1 8201 Micro/Crucial 0xc0a9 0x2263 Silicon Motion 0x126f 0x2262 To check if your NVMe drive is supported by this driver follow these steps: Log onto your ESXi host (that has the NVMe installed). Find the vmhbaX where X is the number assigned by ESXi that holds your NVMe drive. Use esxcli nvme device get -A vmhbaX in the console, replace X with your number from the previous step. Find the PCIVID (VendorID) and ProductID in the list. If the PCIVID and/or ProductID don’t show for your device, try finding it in the list of esxcli hardware pci list.Now, based on the results you end up with one of the following options:My VendorID and ProductID matchYou can download and install the community driver. Download version nvme-community-driver_1.0.1.0-3vmw.700.1.0.15843807-component-18902434 Upload the zip to your ESXi hosts /tmp folder. Install by using: esxcli software vib install -d /tmp/nvme-community-driver_1.0.1.0-3vmw.700.1.0.15843807-component-18902434 Reboot.My VendorID matches but not the ProductIDYou can try the community driver, success is not guaranteed but it can probably work, follow the steps above for “My VendorID and ProductID match”.None of the ID’s match at allYou are out of luck, please follow the steps from my previous blogposts to try and get it working manually. There is absolutely no guarantee this will work by adding an old ESXi 6.7 driver to an ESXi 8 install. Please don’t try this if you are not willing to do a complete reinstall!NVMe SSD not recognized 7.0ConclusionThat concludes this post and you should now have a working NVMe drive!" }, { "title": "Big update for older Tesla's just dropped! (2022.8.10.5)", "url": "/posts/big-tesla-update/", "categories": "Electric-vehicles", "tags": "sustainable-housing, energy, electric-vehicles, tesla, home-automation", "date": "2022-09-11 17:14:00 +0200", "snippet": "For the full release notes, please see the table of contents to the right or scroll down.My Tesla Model S was one of the first to arrive in Europe in 2013 and is now almost 9 years of age. I bought it as a used car (if only I was rich, I could buy a new one) about 2,5 years ago and since that time there have been two, maybe three small updates. The fact that the car still receives updates and improvements after all this time is awesome, but they are quite rare and usually don’t really add functionality.Yesterday, I got a notification in the app, an update was available. As always I schedule the update and when it’s done I usually see what changed when I get into the car for the first time. This time, it was different! When I got the notification that the update was finished I soon noticed new entries in my Tesla app and there it was! Some of the most anticipated features people have been asking about for years and never thought we’d get: Remote scheduled charging/departure settings and remote charging control for the max amps. This is big! Thanks Tesla!There are also major changes to some other things, like the UI, button configurations and driver profiles. This is one big feature rich update.Why is this big?As you know, I’m into home automation and sustainable housing. Consuming electricity is something that should be in full control and I like to do that automatically based on formula’s wherever possible. Before I can do things like that, I need an endpoint to talk to and set specific limits for different kinds of things.This endpoint was never available through any API for the older Tesla vehicles and impossible to configure. This means that whenever you plugged in the charger for the Tesla and wanted it to, for example, follow the power production of your solar, you would be in the car adjusting the maximum amps the Tesla could charge manually.Another big home automation example is the Scheduled Departure setting. There is one time option to set, 9:00h for example, at which the Tesla would be ready to drive with the configured state of charge (SoC). Again, this was only configurable from inside the car. Now, having that added to the app means the API endpoints have been created and we can (probably) start setting this through automation and make it, again an example, automatically follow the work schedule.All in all, this opens up a lot of possibilities and you can find people requesting this way back in 2016 and probably even before that. Stay tuned for a post when I try to set up a project or my own custom home automation to control all this automatically from my servers.Apart from that, what else?UI ChangeSo, the first thing I noticed when I got into the car: The UI changed. Now this is obviously very much down to preference, but I like the adjustments to the font. The font looks a bit more modern, is easy on the eyes and even when not directly looking at the characters used I can easily distinguish similar looking numbers and letters from eachother. The overall UI also got a little update, the car menu looks a bit more sleek and easier on the eyes if you ask me. It also looks like Spotify got an update as it seems more responsive and overall things seem less laggy on screen.New icons and customizable barThere are also some new icons and “bar” which can be configured to your taste. The new setup certainly makes it look less cluttered but I’m not a fan of the random colors, I prefer my icons unified and to nicely blend in with the theme. For me, it now looks like the icons are out of place and came from some Emoji wielding Twitter wizard shouting “Look how fun and happy all these different colored icons are!!”. I guess we’ll have to live with it for now.Supercharging menu tipsWithin the Charging menu, there is now a link to “Supercharging Tips” which I don’t remember was ever there before, tapping the link shows the following on-screen. Which is quite interesting for people that usually don’t do a lot of research into what car they are driving. Easy tips people!Mobile app charge statsThe Tesla app now also has a new menu called “Charge Stats” which gives an overview of where and how much you’ve charged the last 31 days. I feel like this menu is still quite “beta” as it seems very confused. It shows my currency in British Pounds, while I’m Dutch and use Euro’s; At the same time I can only choose a “County” in the USA for location. So I’m not quite sure what’s happening here, but at least I have a nice quick overview of charges from the app and a gimmicky “what I would-coulda-shoulda saved on petrol”. In the screenshot you’ll see the last bits of our vaction trip to Italy, we drove about 1400km back to The Netherlands in one go using the Supercharger network which took us around 20 hours due to bad traffic.Release notes 2022.8.10.5Since a lot of people are currently asking for release notes and they aren’t published, please find mine below, copied from the car’s infotainment screen (for the 2013 Tesla Model S)Minor FixesThis release contains minor bug fixes and improvements.Cold Weather Improvements (1)When you navigate to a Supercharger, improved battery preconditioning delivers a faster charge.Language SupportYour touchscreen is now available in over 20 languages. To switch your language setting, tap Controls &gt; Display &gt; Language &gt; Touchscreen.Mobile App ImprovementsYou can now adjust Charge Current, Scheduled Departure or Scheduled Charging at your car’s current location from the Tesla app.Note: This functionality requires mobile app version 4.1.0.Cold Weather Improvements (2)You can now enable front defrost and maintain your climate settings when clearing ice and snow. As usual, tap the fan icon and select Keep Climate On when parked.Driver ProfilesEach Driver Profile will now have its own individual Work and Home address. To update, select your profile, tap Navigation and long press either Work or Home.Customizable App LauncherDrag and drop your favorite apps to any position along the bottom menu bar for easy access. To customize your menu bar, hold any icon and then drag to reorder. To adjust climate controls such as heated seats and defrost, tap on the temperature or swipe up from the bottom of the screen. For charging controls tap Controls &gt; Charging.Cold Weather Improvements (3)You can now precondition the cabin from the Tesla app when your battery is at a lower state of charge. Simply turn on climate from your Tesla app and override the previous setting by tapping “Yes” on the confirmation pop-up window. Note: To protect your car’s battery, climate will remain unavailable under extreme low charge scenarios. This feature requires the Tesla mobile app version 4.4.0 or later.Dark modeYou can now change to a dark themed display. Tap Controls &gt; Display &gt; Appearance and select Dark.Hide Map DetailsSimplify your navigation app and hide map details by tapping the pin button on the map.Active Phone CallsActive phone calls will now be displayed in the status bar at the top of the touchscreen. You can answer, hang up or swap calls from the card anytime. Swipe up to dismiss and tap phone icon on the status bar to display again.ConclusionI hope this gives you some extra information regarding this update and that I can do lots of follow-ups explaining how to use these new feautres in home automation. Let me know what you think in the comments or just join our Discord for realtime chat ⧉! All feedback and tips are welcome, please do tell. You can contact me through the comments section, GitHub discussions or directly on GitHub. If you find any errors please open up an issue using this link create an issue ⧉ and I will have a look!" }, { "title": "Saving Energy - Close-in boiler or instant heater?", "url": "/posts/save-with-instant-heaters/", "categories": "Sustainable-housing", "tags": "sustainable-housing, energy, hot-water, kitchen", "date": "2022-09-06 12:54:00 +0200", "snippet": "In Europe, the price for electricity is going through the roof, peaking at rates of €0,90/kWh in The Netherlands. Suddenly, using appliances everyone took for granted are pushing up the bills by hundreds of euro’s. People usually look at things like the fridge, that big TV standing in the livingroom or the computer being turned on all day to save on energy consumption in the house. But what if I told you that the close-in boiler in your kitchen could be consuming more energy than your fridge, TV and computer combined?The situationMost Dutch households have a close-in boiler installed in their kitchen cabinets, it’s supposed to be more efficient than running hot water from the central heating unit, which is often installed in the attic. It’s great for comfort, you always have hot water ready for use in the kitchen and you don’t have to waste 5 liters of water before it actually becomes hot. This comfort comes with a price, that boiler’s water has to be kept at 50°C (sometimes even 70°C, depending on the settings) and will consume energy whether you use it or not. I think that’s a waste and with today’s pricing, a costly one.So how much does a standard popular close-in boiler consume you may ask? Well it depends… on a lot of things. To give you a range, a standard 10 litre close-in boiler will use anything between 300kWh and 700KWh per year depending on the usage. When we bought our house it had the (very popular) Plieger 10l boiler and it denotes a yearly usage of 526kWh on the EU Energy Label. Calculating with a (current date) conservative €0,5/kWh that’s €263 per year, just for hot water in the kitchen.Possible solutionsThe most ideal way to get hot water is by using a heat pump, it’s very efficient in warming up water and some heatpumps are already showing they can create upwards of 4kWh thermal energy from 1kWh electricity (COP ⧉). This solution will be able to provide the same 50°C of water at less than a quarter of the price any standard close-in boiler would. But not everyone has a heat pump these days and even if you have one, it’s not always possible to connect the kitchen’s hot water to the heat pump’s boiler.Another solution, which this post is about, is the instant heater (also flow heater or instantaneous heater). For us Dutch people, this concept is quite unknown, when you go to one of our neighbouring countries however, instant heaters can be found everywhere and are very commonly applied from kitchen to bathroom. The instant heater has the same COP as a close-in boiler since it uses electricity to directly heat the water, which is 1:1 (every 1kWh used produces 1kWh of thermal energy). The main difference is that the instant heater does not store hot water but instead produces it when you turn on the tap. All those losses from a close-in boiler keeping the water at a constant temperature are non-existant. Due to having no buffer, the peak power consumption of the instant heater is a lot higher than that of a close-in boiler though and it could push the limits of the electrical circuits in the house. Instant heater peak power consumptionA real world exampleObviously, all this talk about both solutions won’t have much weight without some actual data backing it. When we bought our current house almost four years ago, a 2-month old Plieger 10l close-in boiler came with the kitchen from the previous owners. As my goal was to limit my power consumption as much as possible to be able to run the house completely from the solar panel’s generated power, I kept a close eye on power consumption in the house during the first months of construction. One meter in particular popped out and, you guessed it, it was the boiler.Given that our kitchen also has a dishwasher and we only use hot water in the kitchen maybe twice a day (less than 2 litres), it didn’t make sense to keep a boiler at temperature all the time. Apart from that, the boiler was connected to its own 16A circuit breaker which meant I was looking for an instant heater that would fit into that. The smallest one I could find actually required the full 16A when turned on and would deliver a measly 2 liters per minute of hot water, but for us, that’s more than enough in the kitchen.Putting our situation into perspective with real data:   Plieger 10l boiler Clage MBH3 instant heater Price (€) 175 130 Energy usage (kWh/year) 432 15 Max. water temp. (°C) 76 ΔT=25 (water temp +25, est. 45) Max. Flow (l/m) Limited by tap 2 Peak power (kW) 2 3.5 Size (mm) 290 x 275 x 450 135 x 186 x 87 Mounting None, standing Wall mount As you can see, there are some limitations during use, like the maximum temperature and flow. In our situation, we don’t even notice it as we don’t require higher specs. The instant heater also has a very small body that can be bolted to the wall, our whole kitchen cabinet is free for storage. One added positive note for us, the temperature that’s reached is right at the edge of getting that burning-your-hands-feeling, it’s quite safe!Does the instant heater save money?The short answer is, yes, it will save money as it’s more efficient to only heat water when it’s required.The long answer is still, it depends. If you can live with less litres per minute flow and don’t want water temperatures above 50°C it’s a no brainer to get one and it can easily be swapped with your current boiler. If you want higher flow rates and temperatures and do the dishes in the sink, you will most likely need an electrician to upgrade your circuits before you can use the instant heater for your requirements, this can be quite costly but can still make sense in the long run. If you already have a heat pump connected, it won’t help you, keep the heat pump!Based on my data, using the instant heater saves us 417kWh per year which is around €208 euro per year with the current electricity prices. The past 3-4 years combined has saved us around 1.5MWh of energy.ConclusionSwapping out the close-in boiler for an instant heater was one of the best early decisions I made for the house and my electricity bill. I hope this experience puts things into perspective an maybe help you make a decision or save on your monthly bills. Small tip if you want to buy an instant heater as a Dutch person, get it from Germany as the price for instant heaters is 50% of what Dutch shops are asking.Let me know what you think in the comments or join our Discord for realtime chat ⧉! All feedback and tips are welcome, please do tell. You can contact me through the comments section, GitHub discussions or directly on GitHub. If you find any errors please open up an issue using this link create an issue ⧉ and I will have a look!" }, { "title": "Fujitsu BSB-LAN Monitoring", "url": "/posts/fujitsu-bsblan-monitoring/", "categories": "Home-Automation, Heating", "tags": "home-automation, domotica, heating, documentation, tutorial, grafana, influxdb, mqtt, node-red", "date": "2022-08-26 19:25:11 +0200", "snippet": "IntroductionIn the last blog post (Fujitsu Waterstage home automation/domotica) I talked about monitoring my Fujitsu Waterstage using the BSB-LAN appliance. This post will explain the specifics on how I set this up within my environment. Although I will be sharing all my files and configs from multiple applications as examples, I’m 100% sure that there are better ways to set up the Node-Red flow more efficient, as I just did this quick and dirty. Somewhere during 2021 InfluxData released their new Flux system based on InfluxDB 2.0. Since this is a big change essentially forcing me to rewrite all my Grafana dashboards and scripts to update to the latest version, I haven’t done that yet. If you are starting with a blank page, my advice would be to use InfluxDB 2.0 and rewrite my examples from InfluxQL to Flux. Even though this guide will lose its copy paste value, this will save you a LOT of time in the future redoing everything like I will have to.GuideGoalsThis post will explain the following: Configure MQTT in BSB-LAN. Verify the data is received on the MQTT server. Create a new InfluxDB database and user. Leverage Node-Red to read the MQTT messages and write them to InfluxDB. Use Grafana to connect to the database and create a dashboard.RequirementsBefore we continue, lets set up a list of requirements. This guide expects the following services to be present and running on your network. I will not explain setting up every single service in this guide. There are hundreds of setup guides and documentation is readily available for these well-known services, please make sure they are running before continuing. MQTT server An MQTT server is required to receive and distribute messages sent by BSB-LAN. I am using Mosquitto ⧉ running in a container. InfluxDB InfluxDB is a time series database which will store the sensor data coming from BSB-LAN, which can be consumed by Grafana. This post is based on InfluxDB 1.7 running in my environment, any version using InfluxQL should work without modifications. Node-Red Node-Red is a visual flow-based programming tool which I will be using to read BSB-LAN data from the MQTT server, modify the datastructure and inject the data into the InfluxDB. My Node-Red ⧉ is running in a container. Grafana The actual dashboarding program to visualize the sensor data coming from the heatpump/BSB-LAN. It connects to the database for sensor data. Just like the others, my Grafana ⧉ runs in a container.Configure BSB-LAN to MQTT Logging Step 1 One of the first things that’s required for MQTT to even work on the BSB-LAN device is a change in the configuration. In the original guide I mentioned this as an optional step to prepare MQTT. If you have already done that optional step, feel free to skip to Step 3. First, open up the BSB-LAN Arduino project and find the BSB-LAN configuration file BSB_LAN/BSB_LAN_config.h. Within this file there is a section dedicated to MQTT. The values to edit will be: mqtt_mode - To tell BSB-LAN to use MQTT and also which format to use, I use the plain text format for my setup. mqtt_broker_ip_addr[4] - Configure the IP address of the MQTT server on the network. MQTTUsername[32] - Set a username if authentication is required, leave blank for no authentication. MQTTPassword[32] - Set a password if authentication is required, leave blank for no authentication. MQTTTopicPrefix[32] - Set the topic of the messages, this basically sorts all values in a folder like structure instead of just dumping them all in the MQTT server root. MQTTDeviceID[32] - Gives the BSB-LAN client a name, change this if you have multiple BSB-LAN devices. What the config file looks like for me:#define MQTTbyte mqtt_mode = 1; // MQTT: 0 - disabled, 1 - send messages in plain text format, 2 - send messages in JSON format, 3 - send messages in rich JSON format. Use this if you want a json package of your logging information printed to the mqtt topic// JSON payload will be of the structure: {\"MQTTDeviceID\": {\"status\":{\"log_param1\":\"value1\"}}}// rich JSON payload will be of the structure: {\"MQTTDeviceID\": {\"id\": \"parmeter number from log values\", \"name\": \"parameter name from logvalues\", \"value\": \"query result\", \"desc\": \"enum value description\", \"unit\": \"unit of measurement\", \"error\", error code}}byte mqtt_broker_ip_addr[4] = {192,168,55,54}; // MQTT broker ip address. Please use commas instead of dots!!!char MQTTUsername[32] = \"\"; // Set username for MQTT broker here or set empty string if no username/password is used.char MQTTPassword[32] = \"\"; // Set password for MQTT broker here or set empty string if no password is used.char MQTTTopicPrefix[32] = \"BSB-LAN\"; \t // Optional: Choose the \"topic\" for MQTT messages here. In case of empty string, default topic name will be used// Optional: Define a device name to use as header in json payload. In case of empty string, \"BSB-LAN\" will be used.// This value is also used as a client ID towards the MQTT broker, change it if you have more than one BSB-LAN on your broker.char MQTTDeviceID[32] = \"BSB-LAN\"; Step 2 Because of the changes in the Arduino project config file, the project must be rebuilt and uploaded to the microcontroller. There are two ways of doing this: Locally connected. Just like the original guide, connect the microcontroller to your computer through USB and flash it through the serial connection. Disconnecting it from the heatpump is not necessary. Make sure your IDE still has the correct COM port selected (these change sometimes!). From Arduino IDE select Sketch-&gt;Upload and things should be underway. Immediately after open the Serial monitor under Tools-&gt;Serial Monitor to see the feedback from the microcontroller during startup. Make sure it’s online and we’re done. Over the air (ESP32 Only!). BSB-LAN has the posibility to do an OTA flash. Please make sure the BSB-LAN setting General - OTA Update in the webbrowser is defined as On before doing this. From Arduino IDE select Sketch-&gt;Export compiled Binary to build and save the .bin file on your computer (mine is called BSB_LAN.ino.esp32-evb.bin). Now go to &lt;your-BSB-LAN-IP&gt;:8080 in the browser, click Choose File and select the .bin file you just exported, followed by clicking Update. If everything goes well, your BSB-LAN should be back online after a few minutes. If for any reason it bricks, there is no other option than locally flashing it again. Step 3 Before we configure BSB-LAN to actually start sending logs to MQTT (if you followed my install guide, logging will be set to false), it’s time to figure out which parameters we actually want to log. The way I did this was to bring up the technical manual of my heatpump and find all the parameters I want to see. I ended up with the following parameters and entered them into the BSB-LAN web config under Logging - Parameters. Parameters: 500,501,502,503,504,505,506,560,561,562,563,564,565,566,700,710,712,730,740,741,1602,1610,1612,1640,1642,1644,1645,8700,8701,8702,8703,8830,8831,8744,8412,8410,8395,8396,8397,8398,8450,8451,8000,8003,8006,8336 And for reference, what these parameters do for my Fujitsu Waterstage: Parameter Description   Parameter Description 500 Time Program HC1 Mo   1610 DHW temp nominal setpoint 501 Time Program HC1 Tu   1612 DHW temp reduced setpoint 502 Time Program HC1 We   1640 Legionella function 503 Time Program HC1 Th   1642 Legionella function day 504 Time Program HC1 Fr   1644 Legionella function time 505 Time Program HC1 Sa   1645 Legionella function setpoint 506 Time Program HC1 Su   8700 Outside temp sensor 560 Time Program 4 DHW Mo   8701 Lowest historic outside temp 561 Time Program 4 DHW Tu   8702 Highest historic outside temp 562 Time Program 4 DHW We   8703 Outside temp attenuated (24h avg) 563 Time Program 4 DHW Th   8830 DHW temp actual value top 564 Time Program 4 DHW Fr   8831 DHW temp current setpoint 565 Time Program 4 DHW Sa   8744 Flow temperature setpoint 566 Time Program 4 DHW Su   8412 Flow temperature supply 700 Operating Mode   8410 Flow temperature return 710 Room temp Comfort setpoint   8450 Operating hours compressor 712 Room temp Reduced setpoint   8451 Compressor start count 730 Summer/winter changeover temp   8000 Status heating circuit 1 740 HC1 Flow temp min limitation   8003 Status - Status DHW 741 HC1 Flow temp max limitation   8006 Status - Status Heat Pump       8336 Heat Pump total operating hours Step 4 With the parameters all configured we have to think about the interval at which BSB-LAN will send sensor data to MQTT. At first I thought, well, lets do this every 5 seconds! Unfortunately, that’s not going to work. As mentioned in the previous guide, the BSB protocol is very low bitrate. Depending on your heatpump it may take up to a full second to retrieve a parameter value from the heatpump. My current setup, with the parameters above, takes about 25 seconds to complete. With my initial idea of a 5 second interval, BSB-LAN would crash as it started a new interval before the last task was finished.So with 40+ parameters to log taking around 25 seconds, I settled with an interval of 30 seconds, giving around 5 seconds to spare before starting the new interval. Keep in mind that BSB-LAN is a single process project. When BSB-LAN is busy polling and logging the parameters the webinterface and all other functions will be queued. In case of my setup, BSB-LAN will be unresponsive for 25 seconds and then function for 5 seconds before entering the 25 seconds unresponsiveness again in a loop. Play with the interval or the number of parameters to adjust this to your liking. Step 5 Verify the configuration in the webbrowser and switch the Logging - Logging enabled option to On. It should look something like the screenshot below. If all is well, press the Save parameter button on the bottom of the configuration page to enable it all. Step 6 The last step is to verify the sensor data actually reaching the MQTT server. I use an awesome free small program called MQTT Explorer ⧉. To give you an idea what it should look like:Set up InfluxDBWhen it comes to storing data, I like to keep my different types of sensor data in seperate databases. This is nothing more than preference and as far as I know has nothing to do with best practices. What I’ve done is create a new database on my InfluxDB system with a dedicated user and password. Also, my InfluxDB is still running in a VM, so I have easy access to the CLI to do database maintenance. You can also use external management tools or API calls with cURL, if you want to do that, the answer is a Google query away. I will explain the CLI option here.There aren’t a lot of things to do, so lets get into it: Log on to the InfluxDB system to get to the CLI. In the following step I’m authenticating with plain-text passwords in the shell. Please keep in mind that this is a possible security breach as the system shell command history will show your plain-text password for anyone on the system. In any production environment, please log on with encrypted passwords or use the “auth” command inside the InfluxQL CLI to avoid this. Type influx -username admin -password &lt;password&gt;, this should be the admin account you set up during installation, if you set it up without user, no authentication is required throughout the following steps, but I recommend setting it up. matts@influxdb:~$ influx -username admin -password &lt;password&gt;Connected to http://localhost:8086 version 1.7.6InfluxDB shell version: 1.7.6Enter an InfluxQL query&gt; Create a new database with CREATE DATABASE &lt;databasename&gt;, I will use ‘heatpump’ as DB name. &gt; CREATE DATABASE heatpump&gt; Verify it has been added with SHOW DATABASES. &gt; SHOW DATABASESname: databasesname----_internalheatpump Create a database user with CREATE USER &lt;username&gt; WITH PASSWORD '&lt;password&gt;'. I create a user called heatpump_dbsa (heatpump as the database name and _dbsa short for database service account, just a little naming convention) &gt; CREATE USER heatpump_dbsa WITH PASSWORD '123456'&gt; Verify user has been added with SHOW USERS. &gt; SHOW USERSuser admin---- -----admin trueheatpump_dbsa false Finally, assign rights for the created user to allow database access using GRANT ALL ON \"&lt;databasename&gt;\" TO \"&lt;username&gt;\". &gt; GRANT ALL ON \"heatpump\" TO \"heatpump_dbsa\"&gt; Verify with SHOW GRANTS FOR \"&lt;username&gt;\" &gt; SHOW GRANTS FOR \"heatpump_dbsa\"database privilege-------- ---------heatpump ALL PRIVILEGES&gt; Set up Node-Red flowsI use Node-Red for any automation and logic that’s required to make things work together. In this case a Node-Red workflow will be used to transform the messages from MQTT to something that can be saved to the InfluxDB database. What I’ve set up is a very simple flow to do exactly what I need with static values and duplicated this for each parameter. This is very basic and not as efficient as it can be. Ideally, it would be a single flow that would dynamically load the parameters and write the correct values to the database. My programming/scripting skills are not that great and the solution is quite ugly in my opnion, but it does the job. If you have any tips or examples, feel free to show me!Node-Red flows consist of nodes, this flow requires one additional node that needs to be installed, it’s in the InfluxDB nodes package. To install this package, press the hamburger menu (top right) and go to Manage palette. A menu opens with two tabs named Nodes and Install, go to Install. In the searchbar type influx, find node-red-contrib-influxdb in the list and click the install button (As I have already installed it, it says installed).To give you a headstart I’ve created an importable copy of my own flows, since the JSON file is quite large please grab it from the MattsTechInfo/kickstart repository ⧉.Once again in Node-Red, press the hamburger menu (top right) and go to Import. Copy the JSON code from the file linked above and paste it into the text area, or, download the node-red-flows.json file and upload it. Also select Import to: new flow. You can now drop all the nodes onto the canvas by clicking when they are in a position you like.Now there are two configuration nodes that have to be edited, the MQTT server/broker and the InfluxDB server. MQTT On the top-right there is an Info button which should be opened by default, if not, click it. In the flows and nodes tree below that, find the MQTT Server configuration node and double click it. (Global Configuration Nodes -&gt; mqtt broker -&gt; MQTT Server) The configuration panel will open. Replace the Server, which currently says replaceme, with the DNS or IP adress to your MQTT server. Optional, rename the Client ID if you wish, I called it Node-Red. Security: If your MQTT server requires TLS, please set the checkmark. If your MQTT server requires authentication, please set the user and password on the Security tab. Press the Update button. Your MQTT node is now configured. InfluxDB Just like the MQTT node, find the [v1.x] InfluxDB - Heatpump configuration node and double click it (Global Configuration Nodes -&gt; influxdb -&gt; [v1.x] InfluxDB - Heatpump) Replace the Host, which currently says replaceme, with the DNS or IP address to your InfluxDB server. Replace the Database if you gave it a different name before. Set the username and password created during the setup InfluxDB section. If you’ve configured InfluxDB to use SSL/TLS, please enable it here. Press the Update button. Your InfluxDB node is now configured. The last step is to deploy the flows, this will mark the canvas as active within Node-Red and will start “working”. This can simply be done by pressing the big red Deploy on the top right next to the hamburger menu. Fun fact, this only turns red when you have active changes that differ from the currently deployed version. After every change you make in the future, be sure to press deploy or your changes will be gone.If everything worked out you should see something like this (MQTT nodes should show green and connected, InfluxDB nodes show nothing unless it throws an error):Building the Grafana DashboardNow that all the sensor data is in InfluxDB, it can be converted to a visual dashboard using Grafana for a nice overview and all kinds of posibilities to view telemetry. Building Grafana dashboards takes a lot of time, but I love both the looks and functionality of a well thought out dashboard. Even though my current Heatpump dashboard is just the first iteration, it will show most interesting data for my Fujitsu Waterstage. Just like the Node-Red flows, you can also copy my dashboard to get a kickstart!Before importing the dashboard Grafana needs a data source configured so data can be accessed after the dashboard import. In the sidebar menu (on the left) press the Cog icon. The Data Sources page will be opened. Click on the button Add data source. Find and click InfluxDB under the Time series databases section. Give your data source a name, I called mine Heatpump. Select the InfluxQL query language. Set the URL to your InfluxDB DNS name or IP address, make sure to include the port (add :8086 for the default). Activate Basic auth. For the Basic Auth Details fill in the database user and password configured earlier (for me, that’s heatpump_dbsa). Under InfluxDB Details, change the Database to heatpump or your own if you created a different one. Don’t touch anything else and press Save &amp; Test.If everything was filled out correctly, you should see the following pop up:Now all that’s left to do is to import the dashboard JSON to Grafana. Again, the JSON file used for the import is quite large, please copy it from the MattsTechInfo/kickstart repository ⧉. If you’ve changed the name of the Data Source in the previous step, it must be changed in the Grafana Dashboard Panels as well. Changing the dashboard panel’s datasources one by one is quite tedious, I suggest opening the JSON in your favorite file editor and replacing \"datasource\": \"Heatpump\" with \"datasource\": \"yourdatasourcename\" before running the import.In the sidebar menu, hover over the + sign and click on Import. Copy the JSON code from the file linked above and paste it into the text area, or, download the heatpump-grafana-dashboard.json file and upload it. Press the Load button, a new page shows up where you can change the dashboard name and the folder to store the dashboard, press the Import button when ready. Your dashboard is now ready and should show your heatpump’s information!ConclusionCongratulations, you’ve got yourself a nice dashboard to monitor your heatpump. No more looking at the physical display in the utility room.That concludes this post and guide, please feel free to send me feedback or ask any additional questions. You can contact me through the comments section, GitHub discussions or join our Discord for realtime chat ⧉. If you find any errors please open up an issue using this link create an issue ⧉ and I will have a look!If you feel you are missing parts in the guide or if you ran into problems I’m also happy to add that information." }, { "title": "Fujitsu Waterstage home automation/domotica", "url": "/posts/fujitsu-waterstage-domotica/", "categories": "Home-Automation, Heating", "tags": "home-automation, domotica, heating, documentation, tutorial", "date": "2022-07-02 19:25:11 +0200", "snippet": "IntroductionAbout three years ago our house was fitted with a Fujitsu Waterstage heat pump and boiler for central heating and domestic hot water (DHW). This allowed us to go electric only and close off the gas connection to our house.Right from the start, the company that installed our Fujitsu Waterstage promised it supported connectivity to be included in home automation (or as we call it in Dutch, domotica). However, after asking around and consulting Fujitsu in The Netherlands, we came to the conclusion that it was (I quote) “Not possible” and “Not supported”.I kept an eye open during the years and finally, after I actually opened up the Fujitsu Waterstage internal unit, I got a new lead that proved to be the solution!Enter BSB-LANThe Fujitsu Waterstage unit I have uses a mainboard from SIEMENS systems. These SIEMENS mainboards generally use the same communication protocols internally, which means someone might already have something made for this. After some more searching it appears a huge amount of brands use these SIEMENS boards, more importantly, they all use the same protocol, the Boiler System Bus (BSB). This information lead me to a German project on GitHub for heat pumps running not only the BSB protocol but also the Local Process Bus (LPB) and the German Punkt-zu-Punkt-Schnittstelle (PPS) protocols.Please see the excellent project by fredlcore ⧉ called BSB-LAN ⧉.They have an extensive list of supported heat pumps and HVACs, great documentation and are very helpful!I have also bought an assembled BSB-LAN interface board from them, but you can build it yourself if you would want to.GuideThe following parts will explain what I have done to include the Fujitsu Waterstage into my home automation set up. There are many ways to do it, with different hardware, different heat pumps and systems, etc. Since I’m using Grafana for all my home automation dashboards to monitor, that’s my main goal at this point in time. This includes having the virtual status screen that’s on the Fujitsu Waterstage to keep me from having to walk up the attic and physically read what’s happening. The following steps in this guide have all been done on a Windows machine and using the Olimex ESP32. Things may be (slightly) different for you depending on your choice of hardware and OS. Also please keep in mind that not all heat pumps are the same, values can be programmed differently, always make sure your heat pump is supported, this guide is not universal. This guide is based on release version 2.0 of BSB-LAN. Please make sure to use the latest version of the config file if a new version is released while following this guide. Do not copy the example config file unless you run release version 2.0.GoalsThis guide will explain the following: Identify the heat pump. Get the required hardware and software. Prepare Arduino IDE project for ESP32. Configure BSB-LAN software. (Optional) Configure logging to MQTT. Flash the ESP32. Connect the BSB-LAN board to the Fujitsu Waterstage. Get access to the BSB-LAN web interface. Scan the heat pump values to get started. How to use.IdentifyBefore you can do anything, please make sure your heat pump is supported by BSB-LAN. My Fujitsu Waterstage has a mainboard from SIEMENS with type RVS21, which is on the BSB-LAN supported list. To see if your heat pump is supported please see this page of the BSB-LAN documentation ⧉. If your heat pump is not on the list, you can open up the internal unit and see if you can find the mainboard brand and type, mine had a sticker as shown in the image to the right. Remember that BSB is a protocol and is one of the main protocols used in the heat pump business, don’t be put off if your specific heat pump make and model is not on the list, there is a good chance the mainboard is supported and uses the BSB protocol like the others.RequirementsBefore we continue, lets set up a list of requirements. Supported heat pump Obviously, make sure your heat pump’s mainboard is supported by BSB-LAN as explained in the Identify section. BSB-LAN board The BSB-LAN board is the first piece of hardware required. It’s a custom made circuit board that connects to and interprets the BSB protocol. You can choose to build one yourself or ask fredlcore to buy one that’s already soldered and ready to run. Controller board To run the BSB-LAN software you need a controller board, again, these can be DIY’ed. I’ve gone with the preferred option mentioned in the BSB-LAN manual, the Olimex ESP32-EVB; I also went with the industrial grade (IND) version of it, just to be sure. You can choose whatever controller you like here according to the manual as long as it’s either Arduino Due or ESP32 based. (Optional) Micro SD-card The Olimex supports a Micro SD-card for storage, BSB-LAN can use this to plot graphs and history within the web interface. Not required if you don’t want to see the graphs and logs but you should as it’s best practice. (I’m not currently using this, bad!) Arduino IDE For compiling/flashing the software to the controller board. It should be possible to use Visual Studio Code, but I personally couldn’t get it to work yet with the Olimex build. Copper wire You need two copper wires to connect the BSB-LAN board to the heat pump mainboard. I’ve recycled two short lengths of electrical wire to connect it inside of the heat pump chassis. Please keep in mind that long lengths of wire will require thicker (higher diameter) copper wire to avoid loss of signal. Network To allow for communications I will be using WiFi, the Olimex also supports wired connectivity, I might set that up at a later time. (Optional) MQTT Server As I will log sensor data to MQTT, an MQTT server needs to be in place somewhere on the network. I already have an MQTT server running for other home automation tasks.Prepare Arduino IDE for ESP32 Step 1 The first thing you want to do is get the latest BSB-LAN software from the GitHub repository. The manual actually recommends getting the latest release archive available using the following link BSB-LAN Master (.zip) ⧉. All required files, for both the Arduino Due and ESP32, are in there. You can also use git if you prefer that option over the download. Extract/Clone it to a location of your preference. Step 2 Before doing anything else, go to the location where the files are extracted/cloned and go into the BSB-LAN-master/BSB_LAN/src folder and remove the Arduino folders ArduinoMDNS and WiFiSpi as they are not required for the ESP32. Even better, they must be removed else you get build/compile errors. Step 3 Go back up into the folder structure, BSB-LAN-master/BSB_LAN and find the file named BSB_LAN_config.h.default. Rename this file to BSB_LAN_config.h. Step 4 Now it’s time to connect the ESP32 board to the computer using USB. You can choose to already have the BSB-LAN board installed on it or not, it doesn’t matter if it’s on or off since we are just flashing the code to the board at this stage. I had mine connected with the BSB-LAN board already attached. Step 5 Go back to BSB-LAN-master/BSB_LAN and open up the file BSB_LAN.ino, Arduino IDE will start up and open the project, all files associated with the project will be opened up automatically. Step 6 Before configuring the Arduino IDE board for the project, verify if the ESP32 board variants version is version 2.0.2 or higher, this can be checked in the Boards Manager at Tools-&gt;Board-&gt;Boards manager... . If it’s lower, install a higher version. If you do not see any ESP32 boards at all, go to File-&gt;Preferences in Arduino IDE and add the following URL to the “Additional Boards Manager URLs” field: https://raw.githubusercontent.com/espressif/arduino-esp32/gh-pages/package_esp32_index.json. Press OK to save the changes and check the version to verify it worked in the Boards Manager. Step 7 Next up are the project settings under Tools to make sure it matches with the ESP32 that’s being used. For me, this is an Olimex ESP32. Board: Olimex-ESP32-EVB Upload Speed: 115200 Flash Frequency: 80MHz Partition Scheme: Minimal SPIFFS (Large APPS with OTA) Port: COM# (For Linux it will be something like /dev/ttyUSB#) If you can’t see the COM port on Windows, you might miss an essential driver, please click this ⧉ link for driver info and download.Configure BSB-LAN softwareHaving Arduino IDE completely set up and ready to go, it’s now time to start working with the actual BSB-LAN software. Like most, it needs to be configured. The bare minimum configuration requires the network settings, most other settings can be configured (after successful flashing) from the web interface. All initial configuration will be done in the file called BSB_LAN_config.h, the one that was renamed during an earlier step. The following steps will list all configuration changes I’ve done to enable all functionality I need. To view my complete config file, please click this ⧉ link to see my current (password redacted) config file in the kickstart repository on GitHub. Feel free to copy where needed. Enable WiFi To enable WiFi, not much is needed, all that’s required is to enable it in the config and set the SSID and Password. To enable WiFi, the //#define WIFI line needs to be uncommented. The WiFi part of the config file should look like this, replace the placeholder SSID and Password with your own.#define WIFI // Activate this definement if you want to use WiFi. Note: MAC address can't be set individually.char wifi_ssid[32] = \"WiFi-network\"; // enter your WiFi network name (SSID) herechar wifi_pass[64] = \"WiFi-password\"; // enter your WiFi password here#define WIFI_SPI_SS_PIN 12 // defines SPI-SS pin for Arduino-ESP8266 connection Change the language At the very top of the config file, the first configurable entry is the language. By default it’s set to German as most of the users and it’s creator are German speaking. Don’t be surprised not everything is translated to your language yet, if you feel like translating please let the people at BSB-LAN know! Mine is set to English.#define LANG EN Enable EEPROM (Default) This is a very important setting, even though I did not change it, you should know what it does and what it means. BSB-LAN can write the running configuration to EEPROM and the next time it starts, it will load from EEPROM. This will bypass your BSB_LAN_config.h file but does allow you to configure on the fly from the web interface. If for any reason you lose EEPROM or it bricks, you will lose the changes compared to your BSB_LAN_config.h file used initially. You can disable EEPROM to always load from file, but that will require you to flash every time you do a configuration change or risk losing the changes you made through the web interface. I find using EEPROM is easier to work with.byte UseEEPROM = 1; Listening Port and DHCP/Static IPv4 config You can configure the port to anything you like over here, by default it’s on port 80 (HTTP) and that’s what I kept it at too. You can also set whether to use DHCP or not and if you don’t, declare network properties for static IPv4 configuration (IPv4, Gateway, DNS and Subnet). I’m using DHCP with reservations in my home-automation network.uint16_t HTTPPort = 80;bool useDHCP = true; // Set to false if you want to use a fixed IP.byte ip_addr[4] = {192,168,178,88}; // Please note the commas instead of dots!!! Set useDHCP to true if you want DHCP.byte gateway_addr[4] = {192,168,178,1}; // Gateway address. This is usually your router's IP address. Please note the commas instead of dots!!! Ignored if first value is 0.byte dns_addr[4] = {192,168,178,1}; // DNS server. Please note the commas instead of dots!!! Ignored if first value is 0.byte subnet_addr[4] = {255,255,255,0}; // Subnet address. Please use commas instead of dots!!! Ignored if first value is 0. Enable the Logger As I’m interested in sending values/telemetry to my database via MQTT, the logger is required to enable this. I would actually recommend running a MicroSD-card to allow BSB-LAN to write the logs to and enable the SD option. As I’m currently running without an SD card I have that disabled but will 100% enable it in a future update as this is bad practice!#define LOGGER// Use SD card adapter on ESP32-based boards instead of SPIFFS flash-based storage//#define ESP32_USE_SD Configure Log Parameters and interval Every heat pump has parameters, the numbers that represent a value or configuration setpoint. The log parameters in BSB-LAN directly translate to those of the heatpump. This means whatever parameter you enter here will be retrieved from the heat pump and written to log. During my testing I found that the maximum amount of parameters to log was set to 40, I needed more. Fortunately, the array can safely be increased from the config file. By default log_parameters[40], I changed this to log_parameters[100]. One other important value is the interval at which these parameters will be polled (and sent to MQTT). The BSB protocol is low bitrate, which means very slow. Depending on how many parameters you want to log, adjust the interval accordingly. In my case of around 50 parameters to poll, I ended up with an interval of 30 seconds. Any faster will break as it will not finish polling all parameters before the interval kicks off again. Your results may vary.bool logCurrentValues = false; // Save data in datalog.txt on SD-card.unsigned long log_interval = 30; // Logging interval (to SD card and MQTT broker) in secondsint log_parameters[100] = { 8700, // Außentemperatur 8743, // Vorlauftemperatur 8314, // Rücklauftemperatur// 20000, // Spezialparameter: Brenner-Laufzeit Stufe 1// 20001, // Spezialparameter: Brenner-Takte Stufe 1// 20002, // Spezialparameter: Brenner-Laufzeit Stufe 2// 20003, // Spezialparameter: Brenner-Takte Stufe 2// 20004, // Spezialparameter: TWW-Laufzeit// 20005, // Spezialparameter: TWW-Takte// 20050, // Spezialparameter 20050-20099: 24h-Durchschnittswerte// 20100, // Spezialparameter 20100-20299: DHT22-Sensoren 1-50// 20300 // Spezialparameter 20300-20499: DS18B20-Sensoren 1-100// 20500 // Spezialparameter 20500-20699: MAX!-Sensoren 1-50}; (Optional) Configuring MQTT The last change I made to the config file was to enable MQTT logging. All parameters that are logged are also sent to MQTT at the same interval when MQTT is enabled. What worked for me was to configure BSB-LAN MQTT messages for plain-text so I can pick them up using Node-Red. Set the mqtt_mode = 0 to 1 for plain-text and supply the IP address of the MQTT broker to send the messages to. To keep things neat on the MQTT server I’ve also set a specific topic (BSB-LAN). Which makes my config file look like this:#define MQTTbyte mqtt_mode = 1; // MQTT: 0 - disabled, 1 - send messages in plain text format, 2 - send messages in JSON format, 3 - send messages in rich JSON format. Use this if you want a json package of your logging information printed to the mqtt topic// JSON payload will be of the structure: {\"MQTTDeviceID\": {\"status\":{\"log_param1\":\"value1\"}}}// rich JSON payload will be of the structure: {\"MQTTDeviceID\": {\"id\": \"parmeter number from log values\", \"name\": \"parameter name from logvalues\", \"value\": \"query result\", \"desc\": \"enum value description\", \"unit\": \"unit of measurement\", \"error\", error code}}byte mqtt_broker_ip_addr[4] = {192,168,55,54}; // MQTT broker ip address. Please use commas instead of dots!!!char MQTTUsername[32] = \"\"; // Set username for MQTT broker here or set empty string if no username/password is used.char MQTTPassword[32] = \"\"; // Set password for MQTT broker here or set empty string if no password is used.char MQTTTopicPrefix[32] = \"BSB-LAN\"; \t // Optional: Choose the \"topic\" for MQTT messages here. In case of empty string, default topic name will be used// Optional: Define a device name to use as header in json payload. In case of empty string, \"BSB-LAN\" will be used.// This value is also used as a client ID towards the MQTT broker, change it if you have more than one BSB-LAN on your broker.char MQTTDeviceID[32] = \"BSB-LAN\";Flash the ESP32With both Arduino IDE and BSB-LAN software set up and configured lets flash everything to the ESP32. From Arduino IDE select Sketch-&gt;Upload and things should be underway. Immediately after open the Serial monitor under Tools-&gt;Serial Monitor to see the feedback from the ESP32 during startup. If everything goes according to plan it will show the IP address that was assigned by DHCP (if you are using that) and it can be accessed through the web interface on the configured IP. If the ESP32 has problems connecting to the configured network it will set up a local SSID called “BSB-LAN”. If you see this happening you will need to verify your config and network and reflash. BSB-LAN is configured to broadcast this SSID for 30 minutes and then reboot and repeat.Connect BSB-LAN to FujitsuNow that everything is up and running on the device and network side, it’s time to connect the BSB-LAN board connectors to the heat pump’s systems. For SIEMENS RVS21 boards there is one specific connector we require to gain access to the BSB systems and allow communication. This port is the X86 which, as far as I know, is always green and at the bottom of the board.From the manual of the Fujitsu Waterstage it becomes clear which pins we need, as BSB-LAN acts as if it’s a thermostat. I’ve included a picture from the manual to make sure we’re talking about the same thing. As you can see devices are to be connected to pins 4, 5 and 6 on the X86 connector to be functional. Pin 4 is not to be used as it serves as an optional power supply to the thermostat or as power supply to the wireless thermostat device. So for BSB-LAN we need to connect pins 5 and 6. Although it does not mention in the manual, I’ve found out that pin 5 is CL- and pin 6 is CL+. On the BSB-LAN board you will find the connector closest to the LED is CL+ and the one furthest away is CL-, it also shows this printed on the circuit board. Connect CL- to CL- and CL+ to CL+ and we’re done.Now plug in the USB power and it will start booting.Access web interface and scanWith everything connected and running, go to your favorite webbrowser and go to the IP address of the BSB-LAN device. Depending on whether you configured a password or not you will reach the home page of BSB-LAN. The first thing you should do is allow BSB-LAN to scan the heat pump for available parameters.To do this, go to the following URL and be patient as it will take quite some time to complete the scan: http://&lt;ip-address&gt;/Q. This function goes through all known parameters by BSB-LAN for all supported heat pumps and it will search for parameters supported by the heat pump but unknown to BSB-LAN.To help with the project, please report these results to the BSB-LAN people by e-mail as mentioned on the BSB-LAN GitHub page.Congratulations, your heat pump is now successfully connected to the network! Have fun browsing all the parameters, explore the HTTP calls you can make and see what else you can do with BSB-LAN. Danger, BSB-LAN can be configured to also WRITE values to the heat pump from the configuration page. Please keep in mind that there are no checks or verifications done to avoid problems while writing values to the heat pump! There is nothing that will tell you if you make a mistake. Use at your own risk!How to useNow that BSB-LAN is fully functional, lets explore the possibilities. Clicking through the menu’s will fetch different parameters and their values, some might be more interesting than others and they will be per brand or per type of heat pump you have. Usually all the heat pump’s main parameters are documented in the user manual supplied with your heat pump. I’ve listed some of my most useful parameters to log below, please note the high 8000+ parameters are all diagnostics and can only be read, they are not settings: Parameter Description   Parameter Description 500 Time Program HC1 Mo   1610 DHW temp nominal setpoint 501 Time Program HC1 Tu   1612 DHW temp reduced setpoint 502 Time Program HC1 We   1640 Legionella function 503 Time Program HC1 Th   1642 Legionella function day 504 Time Program HC1 Fr   1644 Legionella function time 505 Time Program HC1 Sa   1645 Legionella function setpoint 506 Time Program HC1 Su   8700 Outside temp sensor 560 Time Program 4 DHW Mo   8701 Lowest historic outside temp 561 Time Program 4 DHW Tu   8702 Highest historic outside temp 562 Time Program 4 DHW We   8703 Outside temp attenuated (24h avg) 563 Time Program 4 DHW Th   8830 DHW temp actual value top 564 Time Program 4 DHW Fr   8831 DHW temp current setpoint 565 Time Program 4 DHW Sa   8744 Flow temperature setpoint 566 Time Program 4 DHW Su   8412 Flow temperature supply 700 Operating Mode   8410 Flow temperature return 710 Room temp Comfort setpoint   8450 Operating hours compressor 712 Room temp Reduced setpoint   8451 Compressor start count 730 Summer/winter changeover temp   8000 Status heating circuit 1 740 HC1 Flow temp min limitation   8003 Status - Status DHW 741 HC1 Flow temp max limitation   8006 Status - Status Heat Pump       8336 Heat Pump total operating hours Apart from these values, you might want to start automating things through the HTTP commands function. This is set up quite simple, as you can just go to the specific URL with an above parameter included to query or set values accordingly. I will not dedicate a lot of time to this in this guide as I don’t use BSB-LAN this way and I have no experience with it (I use MQTT). Please have a look at the BSB-LAN URL commands documentation ⧉ for all HTTP/URL commands available.ConclusionThat concludes this post and guide, please feel free to send me feedback or ask any additional questions. You can contact me through the comments section, GitHub discussions or join our Discord for realtime chat ⧉. If you find any errors please open up an issue using this link create an issue ⧉ and I will have a look!If you feel you are missing parts in the guide or if you ran into problems I’m also happy to add that information.If you are interested in how I included the heatpump in my monitoring system, please see the following guide: Fujitsu BSB-LAN Monitoring" }, { "title": "New blog setup", "url": "/posts/new-blog-setup/", "categories": "General, Blog", "tags": "blog, welcome", "date": "2022-06-22 19:25:11 +0200", "snippet": "Hello everyone!Welcome to my new platform, Matts’ Tech Info! On this website I will update you on all kinds of things I run into during the day. This can be anything related to my work with VMware or whatever I run into at home, working on home automation and the homelab. I often get asked about my home automation setup and other things I do, like future proofing my house to become energy neutral and completely “green”.Blog moved from mattsbos.proBefore, I used to blog mainly about VMware products and things I do at work. The problem was that I completely locked myself into a very specific topic and didn’t have any platform to blog about other things, like that robot vacuum and my home automation running in the homelab. The second half of this year will be used to redirect all readers from the mattsbos.pro blog to this new platform and eventually mattsbos.pro will be nothing more than my professional online profile.All posts from mattsbos.pro have been migrated and can all be found over here.CommentsOver here on mattstech.info I’ve enabled comments using Giscus, this requires having a GitHub account to be able to leave a reaction or comment on blog posts and project pages. Many of you are likely to already have a GitHub account so leaving a comment should be quite accessible! If you don’t have a GitHub account yet, it’s free and very easy.GitHubOne of the other positive things about moving to this platform, which is hosted on GitHub pages, is that everything is completely open-source and accessible through GitHub. This does not only mean you can see how all this is built and learn from it, you can also contribute if you see an error or have a suggestion to make things better. All this allows for a lot more collaboration which I think is great! See the repository on GitHub ⧉." }, { "title": "NVMe SSD not recognized - Update", "url": "/posts/nvme-ssd-not-recognized-update/", "categories": "Documentation, Tutorials", "tags": "documentation, homelab, storage, nvme, esxi, vsphere6.7, vsphere7, troubleshooting, tutorial", "date": "2021-08-12 23:05:10 +0200", "snippet": " Looking for ESXi 8 instructions? Please go to this new post!This is a quick revisit of two older posts that have been extremely popular and found by most visitors of my blog coming from all over the internet.VMware Flings driverWilliam Lam, Wenchao Cui and Yibo Dong have bundled their strengths to develop a community driver to be used with ESXi for several NVMe drives that stopped working. You know, the ones requiring the hacks with rolling back or installing older drivers to make them work. Before you jump right in though, there are a few caveats you have to keep in mind. It will not work for everything! You can find the community driver at the VMware Flings website ⧉.Your path to a working NVMe driveLike I said above, there are some caveats, unfortunately the community drivers don’t support all known NVMe drives out there. In fact, at the time of writing this only the following NVMe drives are supported: Vendor VendorID ProductID ADATA 0x1cc1 8201 Micro/Crucial 0xc0a9 0x2263 Silicon Motion 0x126f 0x2262 To check if your NVMe drive is supported by this driver follow these steps: Log onto your ESXi host (that has the NVMe installed). Find the vmhbaX where X is the number assigned by ESXi that holds your NVMe drive. Use esxcli nvme device get -A vmhbaX in the console, replace X with your number from the previous step. Find the PCIVID (VendorID) and ProductID in the list. If the PCIVID and/or ProductID don’t show for your device, try findin it in the list of esxcli hardware pci list.Now, based on the results you end up with one of the following options:My VendorID and ProductID matchESXi 6.7You can download and install the community driver. Download version nvme-community-driver_1.0.1.0-1vmw.670.0.0.8169922-offline_bundle-17658145.zip Upload the zip to your ESXi hosts /tmp folder. Install by using: esxcli software vib install -d /tmp/nvme-community-driver_1.0.1.0-1vmw.670.0.0.8169922-offline_bundle-17658145.zip Reboot.ESXi 7.0You can download and install the community driver. Download version nvme-community-driver_1.0.1.0-2vmw.700.1.0.15843807-component-18290856.zip Upload the zip to your ESXi hosts /tmp folder. Install by using esxcli software vib install -d /tmp/nvme-community-driver_1.0.1.0-2vmw.700.1.0.15843807-component-18290856.zip Reboot.My VendorID matches but not the ProductIDESXi 6.7You can try the community driver, success is not guaranteed but it can probably work, follow the steps above for “My VendorID and ProductID match, I use ESXi6.7”.If your NVMe drive is still not visible after these steps, the community driver will unfortunately not work with your drive.Please follow the steps in this post: NVMe SSD not recognized 6.7U1+ESXi 7.0You can try the community driver, success is not guaranteed but it can probably work, follow the steps above for “My VendorID and ProductID match, I use ESXi6.7”If your NVMe drive is still not visible after these steps, the community driver will unfortunately not work with your drive.Please follow the steps in this post: NVMe SSD not recognized 7.0None of the ID’s match at allYou are out of luck, please follow the steps from my previous blogposts to get it working manually.For ESXi 6.7: NVMe SSD not recognized 6.7U1+ For ESXi 7.0: NVMe SSD not recognized 7.0ConclusionThat concludes this post and you should now have a working NVMe drive!" }, { "title": "NVMe SSD not recognized 7.0+", "url": "/posts/nvme-ssd-not-recognized-7-0/", "categories": "Documentation, Tutorials", "tags": "documentation, homelab, storage, nvme, esxi, vsphere7, troubleshooting, tutorial", "date": "2020-12-15 10:07:01 +0100", "snippet": "Earlier this year I ran into problems with consumer SSD’s not being recognized in ESXi 6.7U1 and higher due to a change in the NVMe driver that had to do with NVMe 1.3 specification. See the old post for background info.It was now time for me to upgrade ESXi to 7.0 as I had already updated vCenter accordingly. Of course I knew I would run into the NVMe problem again, but this time it took another interesting turn as my previous solution didn’t work anymore. A lot has happened since this post was written, please start from this new post before continuing to make sure you won’t waste your time! Please note: I am using non HCL hardware, the following is NOT supported by VMware, use at your own risk. Using HCL validated hardware will make sure you don’t have these problems.The new problemBecause ESXi 7 is a whole new beast, a lot has changed with the drivers since version 6.7. When I updated to 7.0, my NVMe SSD’s didn’t show up as expected, but when I tried to install the old drivers I lost the complete host. It wasn’t actually dead, but with installing the older VIB’s it somehow interfered with the networking drivers rendering my host unusable as it didn’t have any network connection anymore.Unfortunately, back to searching and troubleshooting. Since there were already multiple people having this same problem in the vExpert community troubleshooting started quite fast with multiple people available. After some time it appeared certain people actually gotten it to work with a solution that didn’t fix it for me, suddenly we are looking at multiple problems instead of just one.Multiple problemsFrom all the troubleshooting it seems there are now two different situations, in this blog post I will highlight the problem I’m having (problem one). Problem 1: Consumer NVMe stopped working 6.7U1+ Problem 2: Consumer NVMe stopped working 7.0+If you did not have problems in 6.7U1+ and started having problems starting from 7.0, please look at the following post by William Lam ⧉.If you did have problems (like me) starting in 6.7U1, please keep on reading.Solution to my problem (Problem one)Right, so the old driver extracting and installing trick doesn’t work anymore and breaks multiple other ESXi drivers on 7.0+. After some more troubleshooting about VIB’s and what’s actually in there, the VIB’s build the bootbank drivers for ESXi. If you look at the /bootbank partition of an ESXi host you will find a lot of &lt;drivername&gt;.v00 files. Apparently the old VIB’s don’t just touch NVMe drivers but also some others, the specific nvme.v00 helps, as this is the fully built NVMe driver.There are a few ways to get this file/driver: SFTP into the ESXi host on 6.7U1+ that already had the fix and copy /bootbank/nvme.v00 to your PC. Download an ESXi 6.7 GA installer ISO and extract the nvme.v00 file from there.Since my ESXi host was destroyed by trying to install the old VIB’s I went with the second option. Any ESXI 6.7GA ISO is good, doesn’t matter if it’s a customized (DELL, HP, etc) one or an original VMware ISO. Just extract NVME.V00 from the root of the ISO and save it somewhere.(Optional, I needed it) I re-installed ESXi 7.0 on my host to make sure my VIB adventure didn’t leave anything bad in the drivers. Rename the NVME.V00 file to nvme_pci.v00, this is the new driver file name in 7.0. SFTP to the ESXi host and go to /bootbank. find the current nvme_pci.v00 file and rename it so you have a backup (I renamed to nvme_pci.v00.bk). Copy the nvme_pci.v00 from your PC to the ESXi /bootbank folder. Reboot ESXi.The NVMe SSD is now visible again, working with the 6.7GA driver on 7.0!" }, { "title": "TrueNAS on ESXi with local storage", "url": "/posts/truenas-on-esxi-with-local-storage/", "categories": "Documentation, Tutorials", "tags": "documentation, homelab, truenas, storage, vmware, esxi, vsphere6, vsphere7, tutorial", "date": "2020-08-13 00:57:21 +0200", "snippet": "In my homelab I try to use as little electricity as possible, not just because I live in The Netherlands and electricity is expensive, mostly because the house I live in is (climate/CO2) neutral and only has 6MWh of electricity per year available from the sun. Due to this I’d rather not have multiple servers continuously running, I much rather have just one piece of hardware. Since I wanted to have a NAS too, I figured I’d try to combine both in one physical server! This guide was originally written using FreeNAS and vSphere 6.7, the steps are still the same for vSphere 7.x and TrueNAS. Warning: TrueNAS does not support running inside a VM for production. VMware does not support RDM functionality with local disks.Why TrueNASSome of you may have searched for NAS software, it’s likely that you ran into TrueNAS during your search. Packing ZFS technology for the storage layer, it’s completely different than your average hardware RAID card in most servers. It has a nice UI, iSCSI, NFS, everything you’d want from a NAS perspective (even VM support and “Jails”). The reason I went with TrueNAS is because of the whole package and my interest in ZFS with all it’s features.Now for people having done more extensive research, you might have noticed their community forums are not so much of a happy place for people trying to run TrueNAS in a VM and asking questions about it. The reactions and links being posted to such questions are mostly based on ancient knowledge and not true for today, some even manage to claim the exact opposite of what the actual developers of TrueNAS say. I’m sure they mean to help, but I found that you shouldn’t write off TrueNAS because of this. I hope writing this blog will give you the correct information, unlike what can mostly be found online.RequirementsNaturally TrueNAS has a few requirements, most are nothing special but there are a few specifics. Make sure you verify all this up front, finding out your server hardware is insufficient halfway through can get quite expensive. TrueNAS has hardware requirements you actually have to think about before buying your server.ProcessorMostly any modern processor will work fine. Inside a VM it can run on a single vCPU without problems. To give you an idea about performance, with a Xeon D-1541 @ 2.10GHz I can saturate 10Gb/s with a single core. I personally haven’t tested with encryption or higher bandwidth, but obviously, the faster your CPU the more performance you will get. I gave my TrueNAS vm 2 vCPU’s just to make sure I don’t get any performance problems.Oh yes, before you ask, 32bit x86 CPU’s are not considered modern…As goes for any other VM, don’t give a VM more vCPU’s than it needs. The more you give, the lower the per-core performance gets due to scheduling. For example, a VM with 2 vCPU’s running at 60% load will perform better than a VM with 8vCPU’s running 15% load.MemoryNow here’s where it gets interesting. Online you will find ginormous amounts of memory to supposedly be required by ZFS. My personal favorite you find everywhere when you search for memory requirements: “Rule of thumb for TrueNAS is 1GB ECC RAM per 1TB of storage space”. Forget it, that’s bollocks!First of all, what amount do you need? The developers of TrueNAS state that 8GB is the minimum and it does not have to be scaled up based on storage size. To give you an idea, I’m currently running 8GB on the VM with 46TB of raw storage spread over 7 disks. As you can see on the screenshot, 1.3GB of memory is in use by TrueNAS services, 0.2GB of memory is still available and a whopping 6GB is reserved for cache. Don’t ask me about the missing 0.5GB.Now here comes the catch, if you want to run deduplication on a few TeraBytes of data, this is where the memory requirements come in. Some calculations show that, depending on the type of data, 1TB of data could possibly use up 5GB of memory using deduplication. It can also use as little as 0.5GB though. Conclusion is, deduplication is costly and you should ask yourself if you need it.Next up, ECC vs non-ECC. Both work, but ECC is recommended to avoid errors in memory to potentially corrupt your whole storage. My personal view on this is, it all depends on how big you see the risk. In terms of numbers I’ve not seen many memory sticks go bad, 99% of the bad ones arrived in that state. TrueNAS works perfectly fine with normal non-ECC memory as long as you accept the risk that it could possibly, once in a lifetime chance, corrupt data. If you don’t want to take that risk, just go with ECC.Disks (and RAID/HBA’s)Now all of the above is pretty important, but where ZFS shines is the ability to manage the physical harddisks and overlaying the software RAID. This means that in absolutely all cases, no exceptions, no hardware RAID is allowed on the server! I can’t stress this enough, your RAID- or onboard controller has to be able to pass through the disks to the OS directly without any form of hardware RAID. The direct passthrough is often called JBOD. For most known RAID-controllers this is often referred to as IT-mode, not all RAID-controllers are capable of this, some may need to have their firmware flashed first, so choose wisely.As for the actual disks, it’s your choice to go with SAS or SATA, it actually does not matter, all are supported. I’m running a combination of Enterprise SAS spinning disks and consumer grade SATA SSD’s. Also, my personal view on disks for any NAS system, please stay away from desktop drives (like WD Green and Blue) and get some good working storage, they don’t have to be that expensive. I would always prefer a refurbished enterprise HDD over desktop drives.InstallationNow that all requirements are out of the way, a small baseline of what I used for this build and blog: Intel Xeon D-1541 @ 2.10GHz (8 cores, 16 threads) 128GB DDR4, ECC-Registered memory 2x 10Gb/s SFP+ networking Embedded LSI 3008 RAID controller Embedded Marvell SATA controller 1x M.2 NVMe XPG GAMMIX S11 Pro 256GB (Consumer grade) 1x M.2 NVMe XPG GAMMIX S11 Pro 512GB (Consumer grade) 3x 14TB Seagate EXOS X16 SAS (Enterprise grade) 4x 1TB Samsung 860 EVO SSD (Consumer grade) ESXi 6.7 Update 2LSI 3008 RAID controllerThis one is a bit special and I guessed/hoped it would work. The LSI 3008 controller is normally a physical add-on card for a PCIe slot, however, my motherboard has an embedded version of it and wasn’t sure how it would function. I just expected it to work the same as a physical card, which was confirmed after some testing. Unfortunately it had no possibility to use JBOD out of the box, fortunately it is based on the LSI 9300-8i controller which can be flashed to IT mode. After flashing, the controller is ready to go, if you need help with flashing, please do a search on the internet, there are countless tutorials available.Marvell SATA controllerThis simple SATA controller already works as JBOD out of the box, there’s nothing else required to configure. Unfortunately, during the PCI passthrough configuration of this controller I noticed it didn’t disappear from the ESXi UI as an HBA. After some extensive research this Marvell controller has firmware problems that doesn’t allow it to be virtualized/passed through. My plan failed, as I require the disks directly passed to the TrueNAS VM. There was one solution left, which is setting up RDM in ESXi. More on that later.M.2 NVMe 256GBJust because it’s possible I’ve added the 256GB NVMe SSD to the PCI passthrough. I will try to use this in the future as a caching solution inside TrueNAS, for now I just prepare it to be used and don’t actually use it yet. Maybe more on this in a following blog post. The reason I’m not using it yet is because TrueNAS already reserves memory for caching purposes. Since the current amount of memory is sufficient for cache and way faster than NVMe I have not yet required an additional caching mechanism.TrueNAS VMTo start the installation of TrueNAS I created a VM with 2vCPU’s, 8GB memory and a 32GB Hard Disk. No other devices attached yet. Downloaded the latest TrueNAS version from the TrueNAS website and mounted the ISO to install the OS. Was as easy as one, two, three. Before I knew it I was browsing the web GUI. TrueNAS immediately grabs all the memory it can get, but as you can see in the screenshot about memory above, it doesn’t necessarily mean it’s not enough.NetworkingThe TrueNAS requirements also state that a minimum of one physical network port is required. This is based on a bare-metal install in a production environment. A lot of community answers tell you to dedicate a physical network port to the TrueNAS VM using passthrough. For ESXi, this is not true and really not necessary. ESXi internal network speed is way higher than your average physical network adapter. Maybe there are other hypervisors out there that might not be very efficient, having slower internal virtual networking than physical, ESXi has no such problems.My personal setup consists of a dual VMXNET3 adapter, one is in my main VLAN where all my computers are attached to, to serve as NAS. The other network card is connected to a different portgroup specifically for storage access from my ESXi hosts. This network card is configured with Jumbo frames (MTU 9000) inside the TrueNAS OS to provide maximum throughput. Don’t forget that the whole network it’s connected to also has to support Jumbo frames, that includes the virtual switch! The choice is yours, it also works fine with a single network card.Storage (physical)As I mentioned above, I have two deviced passed through, directly into the VM. One is the LSI 3008 SAS controller and the other is the NVMe M.2 SSD. But there was also the problem with the SATA controller not being able to be passed through, which I solved with RDM’s.SAS Controller and NVMeAll disks attached to the LSI 3008 SAS controller are immediately visible in TrueNAS. I can see all their information and S.M.A.R.T. can be tested and read without problems. On the disk overview I see all three Seagates and the ADATA/XPG NVMe.Check SAS controller presenceFor the SAS controller you can verify if TrueNAS can see the hardware that was passed through with a CLI command from the Shell menu of TrueNAS. You can try the commands listed below, it only reads controller information, you can just try them both, nothing bad will happen.For SAS3 controllers like my LSI 3008 controller use:sas3flash -listallFor SAS2 controllers (these are a little older) use:sas2flash -listallRDM’s for SATAA mentioned above, my Marvell SATA controller does not support PCI Passthrough, which means I just can’t directly attach the controller to the VM without having the hypervisor layer in between, which would be the easiest way, just like the SAS controller. However, there is another option for us ESXi users that, once again, is absolutely slammed by the TrueNAS community, RDM’s. A quick search on the web will show pretty much any thread regarding TrueNAS and RDM’s to advise you to avoid RDM’s at all cost. Some more research finds that all this information is based on some old facts for ESXi 3.x, a lot has changed and RDM’s work fine nowadays.Please note, RDM’s have a lot of do’s and don’ts, it’s a very specific functionality to use LUN’s as disks on a remote system. In this case we are abusing this functionality for local disks. As mentioned in the disclaimer, this is not supported by VMware. Do this at your own risk, failure to understand how RDM’s work and bad configurations can possibly lead to corruption within TrueNAS. Please see the VMware documentation for all info regarding RDM’s. ⧉Virtual vs Physical RDM’sVirtual RDM’s will give you a lot of options and functionality compared to Physical RDM’s. Things like creating VM snapshots, cloning, migrating or any other functionality that includes the RDM will only be possible on a Virtual RDM. The catch is, to gain this functionality, ESXi will abstract part of the storage layer and handle I/O commands on the hypervisor. This is exactly the functionality that will possibly kill your TrueNAS sooner or later.Bottomline: Never use Virtual RDM’s for TrueNAS disks!That means, when using RDM’s for TrueNAS, Physical RDM’s should always be used. In this case ESXi doesn’t interfere with the storage layer, it forwards all commands directly to the hardware as if the hypervisor isn’t there. TrueNAS will see the RDM as a local disk and can interact with the disk as if it was a local one. You will see no difference between a disk on the SAS controller and the RDM disk. Things like S.M.A.R.T. will also work because of this.Configuring RDM’sSSH access to the ESXi host is required to set up local RDM’s, make sure you have the SSH service enabled for the host.Log in to the ESXi host with SSH and use the following command to list your local disks:ls -l /vmfs/devices/disksDepending on the number of disks in the server, the list can be quite long. Search for the disk names in the list, mine start with t10.&lt;diskname&gt;&lt;serialnumber&gt;.t10.ATA_____Samsung_SSD_860_EVO_1TB_________________S4X6NF0M847329D_____t10.ATA_____Samsung_SSD_860_EVO_1TB_________________S4X6NF0M847334A_____t10.ATA_____Samsung_SSD_860_EVO_1TB_________________S4X6NF0M847473B_____t10.ATA_____Samsung_SSD_860_EVO_1TB_________________S4X6NF0M847568D_____Copy the disks that need to be setup as an RDM to notepad, make sure to copy the full name, including all the underscores.Next thing is to find the location where the RDM links/vmdk’s should be placed. I placed them on the datastore the TrueNAS VM resides on and put it in the VM’s folder as only this VM will use them. For me that’s “mbesxi_local_nvme/mbnas1”.Now with the disks and the location for the RDM links combine them into the create RDM command, I simply call disk one -&gt; rdm1, disk two -&gt; rdm2, etc.vmkfstools -z /vmfs/devices/disks/t10.ATA_____Samsung_SSD_860_EVO_1TB_________________S4X6NF0M847329D_____ \"/vmfs/volumes/mbesxi_local_nvme/mbnas1/rdm1.vmdk\"vmkfstools -z /vmfs/devices/disks/t10.ATA_____Samsung_SSD_860_EVO_1TB_________________S4X6NF0M847334A_____ \"/vmfs/volumes/mbesxi_local_nvme/mbnas1/rdm2.vmdk\"vmkfstools -z /vmfs/devices/disks/t10.ATA_____Samsung_SSD_860_EVO_1TB_________________S4X6NF0M847473B_____ \"/vmfs/volumes/mbesxi_local_nvme/mbnas1/rdm3.vmdk\"vmkfstools -z /vmfs/devices/disks/t10.ATA_____Samsung_SSD_860_EVO_1TB_________________S4X6NF0M847568D_____ \"/vmfs/volumes/mbesxi_local_nvme/mbnas1/rdm4.vmdk\"After running the above commands the rdm1 to rdm4 VMDK’s should be in the chosen location and are ready to be consumed by the TrueNAS VM.Physical RDM VM configurationWith the RDM’s created in the above step, they can now be added to the TrueNAS VM. Again, there are a few things that need to be considered: A virtual storage controller with physical functionality is required. Make sure the RDM runs Physical mode.The virtual storage controller should default to LSI Logic SAS when creating a VM in ESXi, but if there is a different SCSI controller, it will not work since those don’t have the physical disk functions in them. I like to keep my RDM’s on a separate controller, this is not based on any requirement or recommendation. You can also add the RDM’s to any LSI Logic SAS controller you have on the VM. Note, I have not tested with a SATA controller.Now edit the TrueNAS VM settings and add a new LSI Logic SAS controller if you want to, if not, continue adding the RDM’s VMDK’s from the datastore. This is done by adding a new device “Existing Hard Disk” and not “RDM Disk”. In my screenshot you will see I added a new SCSI controller and added 3 existing hard disks to the new controller. (Optional) New controller: LSI Logic SAS Existing Hard Disk: rdm1.vmdk Compatibility Mode: Physical Mode: Independent Persistent (Optional) SCSI Controller: 1 Repeat adding Existing Hard Disk for all RDM’s.That’s it! Now all the RDM’s are available in the correct way, without any filtering from the Hypervisor storage layer. TrueNAS will recognize the disks and will be able to do everything with them as if they were directly attached as a local disk. You can not see the difference from within TrueNAS.Now it’s time to configure the storage pools, which will be different for everyone and has nothing to do with ESXi anymore. Please see the TrueNAS documentation how to continue from this point on." }, { "title": "VMware Homelab 101", "url": "/posts/vmware-homelab-101/", "categories": "Documentation, Tutorials", "tags": "documentation, homelab, vmware, esxi, vsphere7, tutorial", "date": "2020-06-08 23:17:01 +0200", "snippet": " Although the resource figures and versions mentioned in this tutorial are outdated, the rest of the information is still true today.IntroductionSo, you’ve decided to get going with VMware ESXi and VMware vSphere. Maybe you have a customer asking for a specific configuration, maybe you just want to try things yourself or study for a certification exam. Either way, you need an actual running environment that you can break. The first thing that comes to mind is setting up everything at your home, investing in hardware like a server and some storage. This can be quite costly and it’s understandable that not everyone is able to make this investment. Fortunately, VMware supplies the free Hans-On-Labs. Please note this tutorial is aimed at building your own environment at work or at home.VMware Hands-On-LabsAlthough actively promoted throughout the community, there are still a lot of people that don’t know about the Hands-On-Labs sponsored by VMware. These labs are online environments for only you to work in, they are accompanied by instructions and function as great tutorials. Even if you have your own lab, it’s still great to use every now and then. Best of all, it’s free to use after creating a, free, account! Visit the website: https://hol.vmware.com ⧉ or jump right into the catalog: https://labs.hol.vmware.com ⧉PreparationsGoalBefore diving straight in to building a lab, it’s important to find out what you want to do. What is the purpose of the lab, what software will you be running? This can still be very basic but it’s important to find out what you need. A few examples: I want to run 3 VM’s to test an application (Web, App, DB). I want to create a vSphere cluster with High Availability. I want to set up NSX-V for network virtualization.Hardware requirementsBased on the goals above, you can find out what you need in terms of hardware. Remember that the first thing you are likely to run out of is memory, it’s always memory. To give an overview of most used resources ranked from most to least used: Memory Storage CPU NetworkDon’t worry too much about CPU usage unless you know you will run some extremely CPU intensive applications. Of course, this is personal experience, it might be different for your specific use case. Overall estimates of required hardware to comfortably run an environment: Goal Physical cores (CPU) Memory (GB) Storage (GB) Run 3 VM’s 1 8 80 vSphere 2 24 200 NSX-V cluster 4 48 300 As you can see there is quite a steep incline in resources, specifically memory. In this example I calculated enough room for deploying some VM’s using thin provisioning for the VM disks, which means it’s only using disk space of what’s written to disk.CalculateLet’s go a bit deeper into the hardware requirements. The example above is good overall but might not really fit your needs. Here’s a table with some estimates for commonly used lab setups: Product Physical cores (CPU) Memory (GB) Storage, thin(GB) ESXi 1 4 8 ESXi Nested 0.5 4 8 vCenter 2 12 50 Windows VM(latest) 0.25 8 60 Linux VM (latest) 0.1 2 20 NSX-V Manager 1 16 60 NSX-V Controller (1x) 0.5 4 30 NSX-V Edge 0.5 0.5 4 NSX-T(2.4) Manager 1 8 20 NSX-T(2.4) Controller (1x) 0.5 8 30 NSX-T(2.5) Manager (1x) 0.5 8 10 NSX-T Edge 0.5 4 30 VIC Manager 0.5 8 30 VIC Container Host 0.5 4 15 vRealize Lifecycle Mgr. 0.5 16 100 vROPs 0.5 8 100 vROPs Collector 0.5 4 20 vRealize Orchestrator 0.5 6 17 Full vRA deployment 4 64 500 VMware PKS 2 32 200 Example to use above list: You want to run a 3-host compute cluster and 2-host management cluster VMware PKS in your lab, you have 1 physical host, that host would need 1x ESXi, 5x ESXi Nested, 1x vCenter, 3x NSX-T (2.5) Manager, an NSX-T Edge and then 1x VMware PKS. Of course, then you also need some hardware to run the workload. Grand total of hardware needed on the physical server: CPU: 10 physical cores (12 cores to have some workload space) Memory: 120GB (Make it 128GB to have some workload space) Storage: 430GB storage (Make it 500 to have some workload space)DesignNow that you know what you can do with your hardware and chose what you want to build, it’s time to set up a small design before you start installing. Doing this up front will make the process a lot less complicated and you will avoid running into errors or losing track of what is where. To make it easy, name every object in the design ranging from VLAN’s used to host and cluster names. I’ve made an example design based on the example above except I used VIC instead of PKS since I need a VIC environment for some testing. I also supersized it quite a bit because it’s likely I will install VMware PKS later, planning!Deploying the LabExternal NetworkingBefore you start the installation of ESXi, let’s get the network connected to the physical host up and running first. You can do this further down the road, but I prefer to do it up front as it avoids troubleshooting while testing the environment. All I need in the design above are the following VLAN’s: Management vMotion VM Network VICYou must configure this on your switch(es) and connect the VLAN’s to a L3 network device if you like (as you probably want network access from and to some of these VLAN’s). This can be any VLAN enabled router you have on your network.Installing ESXi (physical)Download the ESXi ISO from vmware.com or a custom ISO supplied by your hardware vendor and mount it on the physical ESXi machine. This can be done with USB or in some cases through the management port of the server. In my case I make sure the host has its own static IP address and is connected to the Management VLAN.For extensive information on installing ESXi please watch a video on YouTube or see one of many tutorials already written about this.Configure ESXi (physical)The next step is to configure the host that was just installed. Log on to the host by browsing to the webclient, it can be found by browsing to the hosts IP address. You can see this is now a working ESXi hypervisor. If you haven’t done so during the installation, you can configure hostname, DNS, NTP etc. through the webclient.NetworkingIf you just want to run some VM’s, the standard vSwitch is fine and you can configure portgroups with VLAN’s and start running VM’s on it. There is nothing further you need for this purpose.If you want to run nested ESXi cluster like in my example, now is the time to add a portgroup with VLAN trunking. This makes sure all traffic can travel through this trunk to the nested ESXi later.For nested ESXi hosts to use an uplink from a physical ESXi host there are a few very important settings, without these the nested ESXi host will not communicate. You can find these in the advanced settings of your trunked portgroup. ESXi view of security settings (left) and vCenter view of security settings (right)Some explanation: Promiscuous mode Setting this to “Accept” will allow all traffic from the nested ESXi host. Having this “Reject” (default) will stop the flow and deny traffic. For any other VM, you usually want to keep this on “Reject”. MAC address changes Having this on “Accept” will allow the sending MAC address to be different to the one recorded in the VM’s .vmx file. Since the Nested ESXi host connects other MAC addresses we need to accept everything, not just the one VM MAC address that’s in the file. Normally you don’t need this, however, when you are playing with a test lab changing Nested configs, this will save you some trouble. Forged Transmits Having this on “Accept” will allow outgoing frames to the Nested ESXi to pass even though the destination MAC address differs from the Nested ESXi’s MAC address.StorageFor storage there are multiple options. To keep it easy, to ESXi/vSphere there are two groups of storage, local and shared. Local works fine with a single server, but as soon as you start clustering you want shared storage. Shared storage is often quite expensive for a test lab to get, most home users will only have access to some non-performing consumer NAS solution. Although it can work if you don’t expect too much of it.Local storage is what most home users have, disks present in the server/computer. Since, in the design we’re working with here, there is only one physical server running the nested environment we can turn the local storage on the physical server into shared storage by booting a VM on the physical host to serve, for example, NFS. This small trick will allow you to connect all Nested ESXi hosts to a fake shared storage solution. Just make sure the VM serving the shared storage always boots before any Nested ESXi that relies on it! (Tip: use the AutoStart order)This concludes the physical ESXi host setup for a nested environment and the first update of the Homelab 101 tutorial." }, { "title": "NVMe SSD not recognized 6.7U1+", "url": "/posts/nvme-ssd-not-recognized-6-7u1/", "categories": "Documentation, Tutorials", "tags": "documentation, homelab, storage, nvme, esxi, vsphere6.7, troubleshooting, tutorial", "date": "2020-04-02 22:01:00 +0200", "snippet": "Since I just got myself a new server with m.2 slots available, I bought myself some cheap NVMe m.2 SSD’s. I planned one for placing some local VM’s on and get some good performance, the other was planned to be used as a caching SSD for use with FreeNAS. I was expecting to just plug them in and see them show up as disks in ESXi, create a datastore and off we go, easy right! Well… they didn’t show up. A lot has happened since this post was written, please start from this new post before continuing to make sure you won’t waste your time! Please note: I am using non HCL hardware, the following is NOT supported by VMware, use at your own risk. Using HCL validated hardware will make sure you don’t have these problems.Identifying the problemTroubleshooting starts, I have to find out what exactly is going on. First of all, the first thing I noticed is that the drive actually does show up on the Storage -&gt; Adapters list as “Non-Volatile memory controller”, which is interesting, apparently ESXi does see the drive, but it does not report any Device or usable disk space when trying to create a datastore. It does show it’s connected with the NVMe driver. Also, side-note, the SSD I’m using is an XPG Gammix S11 Pro.Troubleshooting some more on the ESXi CLI, I can successfully identify the SSD, showing it’s fully functional. I get triggered by the NVMe version, it shows 1.3, might there be something wrong with the driver or the disk not supporting this version?After some more (web) searching, I figured out that NVMe 1.3 was long supported and shouldn’t be a problem. At this point I decided to install an older version of ESXi, instead of 6.7 U2, I installed 6.7 GA. To my surprise, it suddenly worked!Fixing the ESXi driversSo, apparently something changed with the NVMe drivers of ESXi between 6.7 GA and 6.7 U2. As soon as I started searching the web I found a fellow blogger that ran into this exact problem before ⧉, only with VSAN SSD’s. The solution was to downgrade the NVMe driver to the one from the 6.7 GA image. Now, there were a few things I ran into that weren’t very clear and you never know when a website goes down, so you can find the way I solved it below.Since we are working within the same main version of 6.7, the older driver can be installed without giving any other compatibility problems, this means simply installing the VIB for the NVMe driver in 6.7 GA will fix our problems. There are two ways, an easy and a little less easy way of installing this VIB onto your ESXi hosts.The easy wayThe easy way consists of simply running two esxcli commands in SSH, this does require your host to have internet access. Please reboot your host after installing both VIB’s.If for any reason the VIB’s are removed from hostupdate.vmware.com, please skip to the little less easy way.Optional: If you want to check the current version of the VIB’s before and after updating, please use esxcli software vib list | grep nvmeesxcli software vib install -v https://hostupdate.vmware.com/software/VUM/PRODUCTION/main/esx/vmw/vib20/nvme/VMW_bootbank_nvme_1.2.1.34-1vmw.670.0.0.8169922.vibesxcli software vib install -v https://hostupdate.vmware.com/software/VUM/PRODUCTION/main/esx/vmw/vib20/vmware-esx-esxcli-nvme-plugin/VMware_bootbank_vmware-esx-esxcli-nvme-plugin_1.2.0.32-0.0.8169922.vibThe little less easy way (still easy…)So if your hosts don’t have access to the internet, the files are removed from hostupdate.vmware.com or you just have a reason to never to take the easy way, there is some manual work involved.Optional: If you want to check the current version of the VIB’s before and after updating, please use esxcli software vib list | grep nvme Get your hands on any ESXi 6.7 GA image depot. This is the zipped file containing all the vibs. I got VMware-ESXi-6.7.0-8169922-depot.zip. Extract the files somewhere. Find the following files: VMware-ESXi-6.7.0-8169922-depot/vib20/nvme/VMW_bootbank_nvme_1.2.1.34-1vmw.670.0.0.8169922.vib VMware-ESXi-6.7.0-8169922-depot/vib20/vmware-esx-esxcli-nvme-plugin/VMware_bootbank_vmware-esx-esxcli-nvme-plugin_1.2.0.32-0.0.8169922.vib Use your favorite SFTP client to upload both VIB’s to the host’s /tmp folder. On the host, execute the following commands: esxcli software vib install -v /tmp/VMware_bootbank_vmware-esx-esxcli-nvme-plugin_1.2.0.32-0.0.8169922.vibesxcli software vib install -v /tmp/VMW_bootbank_nvme_1.2.1.34-1vmw.670.0.0.8169922.vib Now reboot the host.Success!I can now see my NVMe drives and create a datastore." }, { "title": "Homelab Update", "url": "/posts/homelab-update/", "categories": "Homelab, Servers", "tags": "homelab, server, hardware", "date": "2020-03-24 13:01:00 +0100", "snippet": "Something completely different I want to share with you. I have quite an extensive homelab and wasn’t actually in the market for a new one, however I saw a deal on eBay.Why?For the past year I’ve been monitoring my electricity usage, being in a climate neutral house that generates more electricity than it uses, it became more and more apparent that a power hungry homelab really doesn’t fit. Even though it’s for work and/or my career and it doesn’t count towards the calculation of being climate neutral, I wanted to see if I could try and fit it in anyway. I was planning to do this at a much later date (in a few years), but along came a motherboard listing on eBay in the US which was the motherboard I was dreaming of!And so it happened…What?My current setup consists of three DELL rackservers, two R610’s and one R720XD. Together they use about 600W of power, the two R610’s turned off most the time leaves the R720XD running 24/7 at 220W.Ideally I wanted to bring that down to around 50W and not compromise performance for 24/7 usage. This basically means you have to go Intel Xeon-D, which is a so called SoC (System on [a] Chip). These buggers are expensive! With some specifications I’d like just the motherboard with a Xeon-D would cost me at least 2000 euro, that’s without anything else, just a motherboard with a soldered on CPU! And even that was a price if they were available at all.Then two weeks back I stumbled upon a listing, three new in box motherboards with every single thing on board I was hoping for. And it was cheap (in comparison!) at 600 USD. The ordering, and soon building, could start.Bill of Materials (BOM)Time to get some stuff! Product Amount Cost ASRock Rack D1541D4U-2O8R ⧉ 8 core, 16 threads Xeon-D 1 €550 Samsung M393A4K40CB2-CTD ⧉ 32GB DDR4 ECC-Reg 2 €225 Fantec SRC-2612X07 ⧉ 12×3.5″ bays 2U rackmount 1 €220 FANTEC SRC-SR20 ⧉ 19″ rack rails 1 €26 Inter-Tech R2A-DV0550-N ⧉ 2U 1+1 redundant 550W PSU 1 €266 Inter-Tech SAS cable ⧉ 0.75m SFF 8643 -&gt; 8087 2 €39 Delock SAS cable ⧉ SFF-8087-&gt; 4x SATA Reverse 1 €31 Total   €1357 Some extra infoDuring the build I ran into some annoyances, as the documentation of the rackmount and the rails were pretty much non-existent I had to find out that some screw holes were in the wrong place and didn’t align with the power supply, fortunately most of them did line up and the PSU is mounted rock solid. There is also a slight metal edge which almost makes it impossible to swap the lower PSU out in case it fails.The second annoying part was that the rails are supposed to give a full extension of the rackmount for easy access, well, it’s like 20cm short…Power drawThe motherboard I’m extremely happy with, it’s easy to work with, IPMI works a charm, it has connectors for more things I’d ever want. Four case fans are connected to it, it’s extremely quiet and still keeping it cool.Only thing I’d wish for is a virtual console based on HTML5 instead of Java.But hey, this is amazing! It’s currently sitting there running at a stunning 32W! Holy smokes! This is still without extra disks (currently 1 SSD) but this is absolutely worth it. With the cost of electricity here in Holland I’ll recoup the whole cost of this server within two to three years.Final thoughtsNow I still have to finish the build completely with disks and I’m still waiting on the SAS to 4x SATA reverse cable, but so far I’m stoked and really happy I jumped on the eBay listing for this motherboard.Build pictures19 inch rack case unboxedPSU screw holes on the left left dont align with casePSU mount backsideMotherboard mounted in caseMotherboard I/O shieldConnecting PSU cables to SAS backplaneAll internals connectedRacked underneath the R720XD" }, { "title": "vNS Techcon, VCAP’s, vExpert and VMUG", "url": "/posts/vns-techcon-vcaps-vexpert-and-vmug/", "categories": "General, Blog", "tags": "blog, events, public-speaking, certification", "date": "2020-02-28 17:41:00 +0100", "snippet": "It has been a while since my last blog entry, unfortunately I’ve been extremely busy for the past months without spare time for an update on the blog, time for a recap!vNS TechconJust before VMworld 2019 I attended the annual vNS Techcon event in the Netherlands. Intended for the more technical Dutch audience there were a lot of talks about specific subjects.As a speaker I talked about the differences between NSX-V and NSX-T in a ~45 minute session, together with my colleague.CertificationNext to building my house, the holidays and work I was studying for the VCAP-NV and VCAP-DCP Deploy exams. Both of which are three-and-a-half hour hands-on exams testing real deployment skills.I’m happy to announce I passed the VCAP-NV in December 2019 which also means I received the VCIX-NV 2019 accomplishment. I took the VCAP-DCV Deploy exam in February and the results just came in with a PASS. Which means I am now a double VCAP and VCIX-NV!VMware vExpertOn top of the regular certifications from VMware I’ve been granted a second year into the VMware vExpert program. I am part of the VMware vExperts 2020. I did also just apply for the NSX sub-program, as that is my main interest out of all VMware products at this time, fingers crossed!NLVMUGA short note about the upcoming VMUG, I will be speaking/hosting a session about the NSX-V vs NSX-T Distrubuted Firewall. This is a follow up on the NSX-V vs NSX-T sessions I did last year. Unfortunately due to the Corona outbreak the NLVMUG has been cancelled/postponed for now. Keep an eye open for my new speaker slot date and time!" }, { "title": "VMworld 2019 – Day 4", "url": "/posts/vmworld-2019-day-4/", "categories": "Events, VMware", "tags": "vmware, events, vmworld", "date": "2019-11-07 22:15:52 +0100", "snippet": "Today was the last day of VMworld 2019, I had some session planned as back-up but I ended up in the middle of Barcelona with Velocloud and had a session with VMware Global Support at VMworld.SD-WAN by VelocloudThe morning started off with a session that wasn’t at VMworld but at the VMware office in Barcelona. During this session I was allowed to ask some questions about the proposition of SD-WAN by Velocloud and what it all entails. It was good meeting up with the Velocloud team and to get to know them.VMware Global Support ServicesDuring my session with GSS I was able to ask some specific questions about NSX-T and the best way to implement NSX-T for a future proof multi-tenant environment. By leveraging tags and the new scope string you can now introduce multi-tenancy based on the new policy manager which has been brought over from VMware Cloud on AWS.GoodbyeBy now the venue is starting to become empty and people are breaking down the stands. This is the last blog in this series, we’re just wrapping up and waiting for our airplane to arrive.VMworld was great, I received a lot of great information about all kinds of products and roadmaps. My backpack and luggage are full of goodies I didn’t even ask for, if anyone near me likes to have some stickers feel free to send me a message!Alright, that’s all, thanks for reading and I hope you had a great time with these updates in case you couldn’t make it to VMworld 2019 yourself." }, { "title": "VMworld 2019 – Day 3", "url": "/posts/vmworld-2019-day-3/", "categories": "Events, VMware", "tags": "vmware, events, vmworld", "date": "2019-11-07 01:12:55 +0100", "snippet": "And that’s Wednesday already. Days are flying by, with barely any time in between all the appointments it’s easy to lose track of time. Today consisted of a few things: some sessions, some NDA sessions, VMWorld Fest and a visit to the Exchange floor where all the vendor stands are located.Wednesday KeynoteJust like yesterday, the first session to kick off the day was the keynote in the general session area. Ray O’Farrel, Robin Matlock and guest Bear Grylls were speaking at the keynote today.Unlike last year the second keynote is more in-depth about the announcements made in the first keynote by Pat Gelsinger, this means that all the content for this keynote session is pretty much covered by my other session blogs. Although it’s always nice to see some actual real world use-cases.Bear Grylls finished with a great positive and moving talk, some might call it a reality check that we’re all just humans. The idea of being motivated to conquer your limits is a great message, using the introduced method of the four F’s. Failure, Fear, Fire and Faith. Bottom line, don’t fear the unknown or new things, feel confident and up your self esteem.Specific Project PacificDuring this session of Project Pacific, which was actually marked as a deep dive, I finally got some serious info as to how Project Pacific will work. The idea of having a native Kubernetes implementation sounds great but I really couldn’t imagine how this would be possible. Turns out I was overthinking it, alot! One other good thing to know is visibility and management of Kubernetes clusters in the vSphere client is now added.CRX runtime layer on ESXi, those are the magic words. Bringing a workload or the so called Supervisor Cluster as close to the hypervisor as possible. CRX is basically what they call a hybrid between a container and a VM, it’s an extremely thin OS image that interfaces between the workload and the hypervisor and supposedly boots sub-second.Now you might have heard there are two ways of running Project Pacific, you are correct. Next to the Supervisor Cluster there is the so called Guest Cluster, which can be deployed on a normal VM base. The Guest Cluster differs from the Supervisor Cluster in a few more ways like being separated from vSphere management and allowing developers full control of their Kubernetes.Now there is one last thing though, which might be a big showstopper for possible customers. Project Pacific does NOT run without NSX! Supervisor Clusters plumb with NSX networking, in the future Guest Clusters will be customizable to fit your own needs, but you will always need NSX for Project Pacific.Living on the Edge (IoT)I visited this session purely out of personal interest, my house is full of IoT devices with very specific functions. Although last year there was a sneak peak and a session on IoT already I never really thought about linking VMware with IoT. The session gave a nice overview about VMware Pulse IoT Center and how it functions.VMware Pulse IoT Center is the main interface, just like vSphere H5 Client is for your vSphere environment. It allows you to manage and add IoT devices and runs as the control center for these managed devices. Communication is set up with a Pulse client on the edge device, this can be directly in the OS of a camera or through an aggregate device connecting to RS232, just to give some examples. Unlike other products, with IoT there is often no way of bi-directional communication due to NAT or firewalls. Because of this limitation the Pulse client is programmed to contact Pulse IoT Center on specific intervals which can be configured (default is five minutes). The device with the Pulse client is called a gateway in terms of Pulse IoT Center.Because I run a lot of IoT at home, after the session I asked the question if there are any integrations with existing timescale databases like InfluxDB. The answer was no, not yet, however Pulse IoT Center does already run MongoDB and InfluxDB in the background which will most likely be opened up through an API in the future.NSX Security and ContainersAt the end of the day I was in a closed session about NSX Security and containers, to avoid writing double content, I included non-NDA information in the Project Pacific session part of the blog.VMworld FestAt the end of the day, VMworld Fest kicked off. After the announcer announced (apparently that’s what an announcer does) the start, loads of people started moving towards the General Sessions hall which was converted to a party venue.Upon arrival everyone was in line for a burger that wasn’t a burger (it was pulled pork) or was trying to get some sushi at the other bar. The poor vegetarian snacks in the middle were mostly left untouched.The night started with a cover band called RPJ who played some classic songs all my generation is supposed to know. They had some nice interaction with the people in front of the stage too.After RPJ there were two female DJ’s which I couldn’t find the name of. They set up a more zero’s and tens genre of music to get some people moving, I busted a few dance moves here and there.Last but not least, the main act, Stereophonics. to be honest I didn’t know them at all or what to expect. Not really my type of music unfortunately. Some time later the volume kept going up, which hurt my ears, after which I decided to go back to the house and write the blog.End of Day 3Right so that was day 3 of VMworld, again lots of impressions and good information, had some fun at the VMworld Fest. By now my feet and legs are becoming a bit heavy, “time for sleeps and blog you tomorrow”!" }, { "title": "VMworld 2019 – Day 2", "url": "/posts/vmworld-2019-day-2/", "categories": "Events, VMware", "tags": "vmware, events, vmworld", "date": "2019-11-06 02:32:15 +0100", "snippet": "Today was a crazy day, good, but crazy. The schedule didn’t allow for much to do other than sitting down at breakout sessions and meetings with possible new partners or customers. In short, the keynote by Pat Gelsinger, five breakout sessions, partner/customer sessions, vExpert meeting, the vExpert party and the Benelux appreciation party.General Session – KeynoteIn the morning I decided to sleep an extra hour to have a healthy energy level, especially with todays schedule. That meant I wouldn’t be in time to be at the keynote (physically), however, like previous years VMware supplies a livestream for attendees to view. You can guess what I was watching during breakfast.As always, the VMware CEO Pat Gelsinger lead the official keynote and gave us an insight into the road VMware is taking, or rather the vision. Opening up with some smashing numbers crushing all the competition and explaining what developers want and can do on the new upcoming feature base.A short list of big topics in random order: Project Galleon Project Maestro Project Pacific VMware Tanzu Workspace One Virtual Assistant NSX IDS/IPS Expansion Intrinsic SecurityBy now, any of the topics above are generally available to the public, in the future I will dedicate some posts to specific topics. Also on a personal side note, I don’t know who designs these slide shows, but they are on a whole different level!Post-Quantum CryptographyThis session was one of the odd ones out. There hasn’t been much talk about anything quantum computing at all, from my point of view at least. When session registration opened up a month ago this was the first session I subscribed to after yesterdays Kubernetes workshop.This session is easily the most interesting I’ve visited in a long time. Starting off with a short introduction from speaker David Ott, I soon found myself in a quantum story. From the second slide forward, all known scientific facts were off the table and turned into approximations and exclusions of wrongs filtering out the rights. By this time half of the room couldn’t follow or dazed off (no joke).David eventually explained some real world working facts with quantum computer research and projects. It was soon made evident that the threat of quantum computing for our security is way more evident than I initially expected, everything we know in cryptography right now can and will be history in the coming five to ten years. Crypto’s like SHA and AES will be able to cope a bit longer by upgrading the difficulty (key size) but will eventually need to be replaced. On the other side, public keys like RSA and DH will instantly fail with near publically available quantum computers, no matter how small or “slow”.It will be a whole new world for cryptography, the answer is being worked on though and a new quantum fit cryptographic standard might just be in time.VMware BlockchainWhen I went into this session I wasn’t really sure what blockchain could do for me. Of course I’ve heard about it, like half the world I knew that cryptocurrencies were the prime example of blockchain. But what use-cases are there? I didn’t have a clue. Another question I had was, how does VMware offer blockchain as a product?During the session a lot was explained as to how blockchain works, what blockchain does and where it came from. All of this was nothing new for me and was craving to get answers to the above mentioned questions. Eventually it hit me that the clue was in the name of the session (which is too long to add to the header), one word: trust.Trust is the main use-case for blockchain right now. To decentralize data and expect there to be non-trusted sources inside the network. The only way to mitigate this is with quorum of blockchain. This means that if there are eight datasources that have the correct hash for a file and there is a single source that has a different one, it (for the sake of making a point) means that single source is wrong. First question answered.My second question was not mentioned during the session, fortunately there was enough time to ask some one-on-one questions as the rest of the attendees ran off very quickly. The answer I got was that VMware Blockchain is provided as a service (SaaS) with possibilities to run on-premises nodes.Next-Generation Machine LearningThe machine learning session was interesting in a few ways, unfortunately not much because of ML. The session started off with some basic understanding of what ML is and how neural networks are incorporated to make decisions, which is great for someone new to ML.I was hoping to hear some information of how VMware would incorporate ML into a product which could be leveraged to run on vSphere. Unfortunately the only solution that came forward was to “run vSphere Cloud Foundation (VCF) because it’s the ideal platform for ML”. And to “use Project Pacific to run your ML workloads”. Somehow I was expecting some more I guess.One other very interesting thing I heard was that (as some of you might know) Bitfusion was recently acquired by VMware. Now you might say, what’s interesting about that?I quote: “Bitfusion will enable remote use of GPU power running on a dedicated GPU cluster, this functionality will be added in the next major vSphere release.”That means a lot of interesting possibilities! On top of this, it should run on any GPU, not just specific cards. Even though not everything turned out as I was expecting during this session, it was good and had a nice surprise.vExpert PartyAround 7:00PM the last vExpert whisper sessions ended and everyone was getting ready to go to the vExpert party. Although the party already started at exactly this time, we still had to grab a cab and travel there. We arrived about twenty minutes later, got settled and had a few chats with other vExperts.To my surprise Pat Gelsinger walked into the room and was personally greeting each and everyone of the vExperts. Me and my colleague Robin got a picture with the VMware CEO too.This was also the first time I met Corey in real life. Since I got my vExpert certificate there is a steady flow of great updates in the vExpert program, all of these updates are coming from Corey. It was nice to meet Corey and thank him for his great work on the vExpert program.Benelux PartySome time later during the night there was the Benelux party at the local Moritz beer brewery. It’s at the same place as last year and it’s quite a nice (and unexpected) little spot, in the basement.This event is mainly used for networking purposes and having some conversations with peers from the Benelux area.End of the dayThis was a long day! My step counter reached well over 15.000 steps, walking around, sitting, listening, blogging and partying took well over 20 hours today. At least it was a good day and all worth it. I even scored some goodies/swag, unfortunately the vExpert swag was already gone for today so I will have to try again tomorrow!Time for sleep. Tomorrow will be kicked off with another keynote and mainly some sessions I (unfortunately) can’t blog about. Good night." }, { "title": "VMworld 2019 – Day 1", "url": "/posts/vmworld-2019-day-1/", "categories": "Events, VMware", "tags": "vmware, events, vmworld", "date": "2019-11-04 23:20:45 +0100", "snippet": "This morning me and my colleagues had a good breakfast and got ourselves a cab to to the VMworld Europe 2019 venue, the Fira Barcelona. The venue set-up looked the same as last year except for the updated style on the billboards, logo’s and t-shirts. That’s a good thing, it means a bit less of “trying to find my way through the labyrinth!”Registration and Materials PickupJust like other years, first thing to do was registering at the event venue. It was quite nice, couldn’t find any queues, quick QR code scan and badge print, done!Little further down the registration area I was able to pick up the new VMworld 2019 backpack, to my surprise we also got a nice (water)bottle, thinking about the environmental footprint and all, and a T-shirt of which the XL sizes were magically missing.VMvillageAfter registering I explored some parts of VMvillage to see what was around. All the usual area’s were there like the Alumni Lounge, Partner Lounge, VMware Champions, {code}, Assessment and Store.I dropped by to give some partner feedback together with my colleagues and got a nice re-usable straw, again thinking about the environmental footprint. I can see a trend here.General Session AreaRight down the hallway to the area where the keynotes will take place I took a nice picture of all the LED lights. It really does light up the complete hall and there was a dedicated DJ stand for some nice music.Haven’t really found a place where to make my mark yet, but I’m sure that will happen sooner or later. It’s clear that this VMworld is all about making your mark, everywhere.Workshop: Run Kubernetes on VMwareAfter strolling around the venue, it was time to get into the first session, Run Kubernetes on VMware. It’s actually one of the few actual worksops this year, it was fully booked within 15 minutes of registrations opening up. Luckily I was able to secure my spot. Workshops are generally 4 hour long sessions with labs and real world examples. If you are planning for next year, be sure to go to one of these sessions, don’t forget to bring your laptop!The session contents will be shared at a later time with some nice extra’s on my blog, as the current session was hosted on AWS I will try to make it an on-premise explanation for your lab tests.Environmental footprintAs you might have noticed throughout this post, I’ve mentioned environmental footprint a few times. Some of you may or may not know that VMware has been working extremely hard in neutralizing their carbon footprint. Last year it was evident during the keynote that VMware is trying to go all the way in being completely neutral and environment friendly. After seeing paper disappear last year, this year there are no straws or single use cups (exception coffee/tea), most paper has been removed throughout the venue and all trash is now being separated into plastic, paper, organic and other trash.All doneAll that’s left today is some chats with other partners and customers. After that it’s time to get some food and be back tomorrow for a day full of sessions with latest tech like Quantum, Pacific, ML and AI. As a bonus we will see Bear Grylls in the flesh, on stage during the keynote." }, { "title": "VMworld 2019 – Arrival", "url": "/posts/vmworld-2019-arrival/", "categories": "Events, VMware", "tags": "vmware, events, vmworld", "date": "2019-11-03 23:20:45 +0100", "snippet": "VMworld 2019 in Barcelona will kick off tomorrow morning, time to go through some quick facts and what to expect the coming week.A fun weekendThis year we arrived a bit earlier than necessary. We took some time to explore Barcelona in the weekend before VMworld. Last year I arrived on Sunday, the result was actually not having any time to see Barcelona as I was too busy with all the events at and around VMworld. For anyone interested in joining the VMworld coming year(s), take a few days extra to actually explore Barcelona, there are a lot of things to see for all kinds of people.Looking forwardRight, back to VMworld.Just like last year I have a full schedule of sessions and workshops to visit. I will elaborate on these the coming days as I will try to summarize each day of VMworld in a blog post. Monday: Event registration (goodies) and the Kubernetes on VMware Workshop. Tuesday: Post quantum, ML, AI and blockchain sessions. Wednesday: Project Pacific, IoT and VMware sessions. Thursday: NSX-T Reference design sessions.Apart from the sessions there will be a lot of meetings in between and most likely some vExpert business along the way. Feel free to give me a shout if you see me!PartiesLike last year there is an abundance of appreciation parties. Throughout the week I will join several partner organized feasts and will try to be present at the vExpert party as well." }, { "title": "New vExpert", "url": "/posts/new-vexpert/", "categories": "Personal, Certification", "tags": "certification, vmware, vexpert", "date": "2019-09-01 11:17:00 +0200", "snippet": "This is a short update and notification. After I got back from my holiday I was greeted by a nice e-mail from the VMware vExpert team: It is with great pleasure that we welcome you to the vExpert program.Yay!I’m so happy to be part of the vExpert program now, it’s a great recognition for the public events I’ve visited as speaker and at the same time I’m grateful my employer gave me time to pursue all of this.ContentWith the vExpert status I hope I can be of service to a lot of other professionals working with the VMware portfolio. New content is underway on this blog, I hope you will like it!As always, don’t be afraid to ask any questions in the comments or other channels." }, { "title": "Why .PRO?", "url": "/posts/why-pro/", "categories": "General, Blog", "tags": "blog, tld, domain", "date": "2019-06-02 19:10:00 +0200", "snippet": " This post was originally written when these blogs were hosted on a .pro domain name and is kept for archival purposes only, it no longer makes sense on the current domain and platform.So, one of the questions I’ve received, which I didn’t actually expect, is why mattsbos.pro? Why not .nl or .com?I did!First of all, I did register mattsbos.nl. It actually redirects to mattsbos.pro. Many of the common TLD’s are already registered by other people and possibilities are getting more slim every day. For some people it might be impossible to register their name as some more common names other than my own are already registered. For example, years back I tried to register bos.nl as that is my last name, but even way back, that was already impossible, mostly taken by companies back in the days.So why .PRO?Good question, it’s actually quite an easy answer. Most people registering a TLD of their own country set up personal blogs or websites aimed at the consumer life of these people. A more generic TLD I find more interesting for actual companies, like .com, I don’t see the resemblance with what I’m trying to achieve here.So next up you get to some more specific TLD’s like .blog and .personal which, in my opinion, again are consumer TLD’s. I like to keep my professional endeavors split from my private life as the content is completely different in terms of readability and who I’m trying to reach.After some more searching (actually quite easy) I found the .PRO TLD and it makes sense. It was originally intended for practitioners certified by governments, like doctors and lawyers for example. But just keeping it to these people didn’t make sense and they opened up the TLD to the public a few years back, the only requirement is that the website underneath is owned and maintained by the professional that registered it. So it’s explicitly only for personal use and about the profession this person is exerting.There you have it, that’s exactly what I’m doing here, telling you about my profession as a person. See it as a portfolio, a curriculum vitae, a means to explain who I am and what I do as a professional." }, { "title": "Public talk @NLVMUG 2019", "url": "/posts/public-talk-nlvmug-2019/", "categories": "Public-speaking", "tags": "public-speaking, nlvmug, vmware, nsx, dutch", "date": "2019-03-22 14:12:41 +0100", "snippet": "TL:DRRight, just here for the slides and info about the content? No problem. Note: everything is Dutch.SlidedeckNLVMUG-Usercon-2019-NSX-V-vs-NSX-T (PDF) ⧉Full presentationBlog postAs announced earlier, I held a session about NSX-T vs. NSX-V at the NLVMUG Usercon 2019. I can honestly say I was quite excited to have a tech talk in front of all these professionals, most of them with more years of experience than myself! At the same time I was scared about if people were even going to turn up, was my subject interesting enough?It was (great)!I loved it! The interest was overwhelming, during the walk-in period people just kept walking in. Even when I officially started there were still some people dripping into the room, ending up with a room full of people without enough seats to sit everyone down (okay, there were a few free chairs between the crowd, but, hard you know…)What’s even better, pretty much everyone in the room was working with NSX in one way or another, professionally or just practicing.FeedbackAt the end of my session I got a lot of positive feedback and some more in depth questions from the visitors. Of course there were also enough things to improve on for the next time." }, { "title": "Upcoming public talk @NLVMUG", "url": "/posts/public-talk-nlvmug/", "categories": "Public-speaking", "tags": "public-speaking, nlvmug, vmware, nsx", "date": "2019-03-12 12:51:41 +0100", "snippet": "NLVMUGLast year I was at the NLVMUG Usercon as a visitor and learned a lot from great sessions throughout the day. The NLVMUG Usercon is the biggest VMUG Usercon in the world, there is a great amount of interest in quite a few sessions. After my visit last year, I decided this year I would apply for a speaker slot.Great news, the request for a slot was granted! On top of that, my session was also marked as a top session not to miss!NSX-V vs. NSX-TIn my talk I will be focusing on the differences between V and T. VMware NSX is widely adopted as the main product for network virtualization and microsegmentation, the technology however is still quite new to a lot of companies.Next to the differences between V and T I will talk about: which version to choose in which situation, migration possibilities, things you should keep in mind about NSX in general.When &amp; WhereMy session will be at March 21st at 15:50 PM at “De Fabrique” in Utrecht.The NLVMUG is a Dutch event, therefor I will be speaking Dutch.For more info please visit: https://www.nlvmug.com/usercon-2019/Hope to see you there!" }, { "title": "VMworld 2018 – Day 1-2", "url": "/posts/vmworld-2018-day-1-2/", "categories": "Events, VMware", "tags": "vmware, events, vmworld", "date": "2018-11-06 22:20:45 +0100", "snippet": "This year I had the opportunity to go to VMworld 2018 in Barcelona together with four of my colleagues! I had a blast, a lot of great information and some under NDA, so unfortunately can’t tell you any of that NDA inside info.VMworld is a four-day event, in this post I will summarize some of the sessions I found interesting, if you as a reader like more in depth info in the future, please do let me know!VenueThis years VMworld is hosted at the Fira Barcelona in, you guessed it, Barcelona, Spain. A great entrance was set up to make sure all attendees were able to register smoothly, setting me up with a nice quality VMworld 2018 backpack, score!At the main hall a lot of VMware stands were placed, like the Partner and Alumni lounges, Hands on Labs area, Certification lounge and an arcade games area in the middle.Day 1 – NSX-T workshopThe first day was mostly looking at the venue and getting to know my way around in the morning. The afternoon was completely filled with a 4-hour long NSX-T workshop.With a near impossible pace I was dragged through both theory and hands on labs! Fortunately I already have experience with NSX-V, else it would not be do-able.Some short things that were covered: VXLAN replaced by GENEVE. New virtual switch named the N-VDS. Full management from the NSX-T Manager, no longer vCenter. Service Router functioning on an Edge. Load Balancers running on an Edge. Edge is nothing like we know from NSX-V’s ESG. Day 2 – Keynote, N-VDS and Containers Technology SuperpowersPat Gelsinger during the KeynoteThe start of the day was the official opening of VMworld 2018 with the Keynote on the big stage. The first “wow” from my side seeing the sheer amount of people present at this event. The keynote was named “Technology Superpowers”.From within the superpowers, multiple roads to take by VMware were explained. During the keynote it was specifically pointed out what VMware does about the environment and other good causes being the driver for success.Superpower: CloudFor the Cloud superpower it became clear what has come and what is to come in regards to cloud strategies and possibilities for VMware. Not only is VMware running on AWS, it’s soon also possible to leverage the IBM Cloud for all you VMware cloud needs.Aside from already having VMware on AWS, it is expanding to natively operate AWS services within the VMware environment in the future.One other announcement is that VMware has aquired Cloud Health for optimizing cost, security and compliancy in the multi-cloud (currently AWS and Azure).Superpower: MobileDuring the Mobile superpower there was news regarding the roadmap or vision to use any device, any application, on any cloud. There was also a Workspace One demo on stage.Other superpowers: AI &amp; ML and IoTAlthough nothing concrete about Artificial Intelligence and Machine Learning yet, the IoT part showed something new and very interesting. VMware have managed to run ESXi on a RaspberryPi, that means on ARM devices! It was showcased as ESXi version 6.8 on the stand, but everything else was kept secret and absolutely alpha/beta stage.Session: Breaking the virtual speedlimitN-VDS performance scalingIn this session there was a lot of technical information about how the new N-VDS works and what it’s possibilities are. The most important part is that they are now greatly modular and configurable. Completely rebuilt network stack based on NSX-T. (NFV3) Enhanced mode, capable of 40Gbit/s speeds. Intel DPDK support. Telco grade performance. Full NUMA alignment. Multiple CPU assignments. Dedicated physical hardware possible. Full data-plane separation.Session: Container PortfolioUnlike what I expected, this session was completely focused on Pivotal Container Services (PKS). I for one expected to hear something about vSphere Integrated Containers (VIC) too, but not a word! At the end of the session I asked the presenter, what about VIC?! He responded it was not to be mentioned in this session and strictly following strategy towards PKS. When the session ended, the guy next to me said, “Hey, interesting you ask about VIC, I’m one of the VIC developers”, what are the chances right? We had a nice chat about VIC and how it’s developing right now, it might surprise you that it’s actually a fully supported production ready container platform for vSphere!Some PKS specific information from the session: Aimed at Enterprise environments. HA Kubernetes product. Focused on security through NSX-T. Multi-tenant set-up. Fully scalable in the multi-cloud. SaaS based in AWS. Vanilla Kubernetes, fully certified." }, { "title": "Public talk @Infosecurity", "url": "/posts/public-talk-infosecurity/", "categories": "Public-speaking", "tags": "public-speaking, vmware, nsx", "date": "2018-10-22 11:20:45 +0200", "snippet": "Public TalkOn the 31st of October my colleague Robin van Altena and I will host a talk at the Infosecurity venue (Dutch) about our experience running VMware and Palo Alto for microsegmentation (NSX) and segmentation (Palo Alto) purposes.The talk is focused around the journey one of our customers went through being one of the first to implement NSX and what we did to make it all work. We will talk about the pioneering work we had to do, do’s and don’ts, things we’ve learned and things we’d do differently now.Of course there will be time to ask additional questions afterwards!Where and whenYou can join the session by registering at the Infosecurity web page. We are speaking in Theater 16 at 14:00 hours." }, { "title": "Architecting on AWS", "url": "/posts/architecting-on-aws/", "categories": "Personal, Learning", "tags": "courses, aws, architecture", "date": "2018-06-28 19:44:40 +0200", "snippet": "Today I successfully passed the Architecting on AWS course!AWSWhy AWS when you are a VMware guy you might ask?Well, the world is moving guys! AWS is there not to take away customers from your beloved VMware environment, it’s there to add to it. In the future we will probably be using hybrid clouds and eventually it seems likely that a hybrid connection between vSphere on site and AWS in the cloud is really going to happen.To not lag behind, AWS knowlegde is needed to set up the infrastructure we will be using to connect on premise to the cloud and create a seamless hybrid environment.But, certification?Although there is an official exam for the final certification, that’s not currently on my to-do list. It will be on the low priority lane for me." }, { "title": "VMware Tech Summit 2018", "url": "/posts/vmware-tech-summit-2018/", "categories": "Events, VMware", "tags": "vmware, events, tech-summit", "date": "2018-05-24 22:30:10 +0200", "snippet": "The past two days I was in Cork, Ireland together with two of my colleagues to attend the VMware Tech Summit 2018! Part of a small group of EMEA VMware partners we got a lot of quality technical information from the GSS team! The event was two days long and consisted of mostly a morning and an afternoon planning for each day.VMware Tech Summit – Day 1The first day started with an official opening where everyone was present at the big stage, there are a few hundred people here all excited to see what’s going to be presented to us the coming 48 hours. This is the first time for me to visit the VMware Tech Summit.During the day there were some interesting talk about the following subjects: Upcoming techniques and research (Blockchain, IOT, Skyline). Migrating to vSphere 6.7, explaining migration paths and new features like the vGPU and fully supported HTML5 client. NSX top-10 trending issues from GSS. ESXi resource management. Migrating vCenter’s database to Postgres. NSX upgrades and troubleshooting.Next to the above talks there wasn’t much time left to go and “Meet the Experts”. I had some quick chats and it’s great meeting the faces of the people I spoke to on the phone!In the evening there was a nice party/dinner organized by VMware. Food was great and there were some nice live bands throughout the evening. This was also a perfect time to do some networking with the gentleman from VMware and GSS.VMware Tech Summit – Day 2At the start of day 2, there was some extra time to highlight some of the feedback forms us visitors could fill in on day 1. I also left some feedback at the counter, you guessed it, mine was highlighted… So there I was standing up from the crowd, “Yep, hi, that’s mine.” VMware thanked me for the elaborate feedback and picked mine to be the best feedback that was given. Surprised as I was, I got rewarded with a Sennheiser noise cancelling headset! Thanks VMware/GSS!!Further on to the day there were talks about: vSAN and the upcoming features like NVDIMM, encryption and full stack upgrades using VUM in vSAN 6.7. vROps features and roadmap. Short talks about vRA/vRO, Skyline and Workspace One.In the afternoon I took some more time hanging about in the Experts bar, having some chats about different possibilities and inquiries I had seen the past months from a customer point of view.Unfortunately, time passed immensely fast and this already concluded my visit to Cork. I have learned a lot and the Tech Summit is something I hope to be able to visit next year as well.Big thanks to VMware and GSS for hosting this, it was awesome meeting you in person and the visit was priceless!" }, { "title": "Hello World", "url": "/posts/hello-world/", "categories": "General, Blog", "tags": "blog, welcome", "date": "2018-02-01 15:31:00 +0100", "snippet": "Welcome to the platform, I’m Matts. On this platform I will send updates for the world to see, or maybe realistically, just a few other interested persons working with VMware products and other tech.RoadmapI have quite a list on the roadmap to fill this platform with, most things I write are usually quick tutorials or specific explanations about all kinds of things. Suggestions and tips are always welcome, the same goes for asking me questions. Feel free to ask for a more elaborate explanation if it helps you!Venues and eventsAmong documentation and tutorials I will try to keep you updated about special events I’m attending as a guest or speaker. Think about venues like VMworld or the VMUG days (usually in The Netherlands).RequestsMaybe you’d like me to cover a specific piece of software or configuration, tell me about it and I’ll see what I can come up with.Thanks for reading!" } ]
